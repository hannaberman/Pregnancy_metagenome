select(-`# Gene Family`)
GF2 <- GF1 %>%
t() %>%
as.data.frame(strinsAsFactors=FALSE) %>%
mutate(SampleID=str_extract(colnames(GF1), "[0-9]{10}")) %>%
gather("GeneFamily", "Abundance", contains("Gardnerella")) %>%
mutate(GeneFamily=str_extract(GeneFamily, ".*(?=.g__Gardnerella)")) %>%
separate(GeneFamily, c("uniref", "unirefAnnotation"), ": ", fill = "right") %>%
left_join(gardRelativeAbundance0[,c("SampleID", "SubjectID", "TermPre", "GWdell", "GWcoll", "Cohort", "Clades")], by="SampleID")
head(GF2)
PA0 <- PA %>%
filter(str_detect(`# Pathway`, "Gardnerella")) %>%
as.data.frame()
rownames(PA0) <- PA0[,1]
PA1 <- PA0 %>%
select(-`# Pathway`)
PA2 <- PA1 %>%
t() %>%
as.data.frame(strinsAsFactors=FALSE) %>%
mutate(SampleID=str_extract(colnames(PA1), "[0-9]{10}")) %>%
gather("Pathway", "Abundance", contains("Gardnerella")) %>%
mutate(Pathway=str_extract(Pathway, ".*(?=.g__Gardnerella)")) %>%
left_join(gardRelativeAbundance0[,c("SampleID", "SubjectID", "TermPre", "GWdell", "GWcoll", "Cohort", "Clades")], by="SampleID")
head(PA2)
PC0 <- PC %>%
filter(str_detect(`# Pathway`, "Gardnerella")) %>%
as.data.frame()
rownames(PC0) <- PC0[,1]
PC1 <- PC0 %>%
select(-`# Pathway`)
PC2 <- PC1 %>%
t() %>%
as.data.frame(strinsAsFactors=FALSE) %>%
mutate(SampleID=str_extract(colnames(PC1), "[0-9]{10}")) %>%
gather("Pathway", "Coverage", contains("Gardnerella")) %>%
mutate(Pathway=str_extract(Pathway, ".*(?=.g__Gardnerella)")) %>%
left_join(gardRelativeAbundance0[,c("SampleID", "SubjectID", "TermPre", "GWdell", "GWcoll", "Cohort", "Clades")], by="SampleID")
head(PC2)
geneFamilies <- unique(paste(GF2$uniref, GF2$unirefAnnotation, sep = ": "))
GFfoldChange <- GF2 %>%
filter(Clades==`1_2`|Clades==`3_4`) %>%
group_by(uniref, unirefAnnotation, Clades, Cohort) %>%
summarise(mean(Abundance)) %>%
ungroup() %>%
spread(Clades, `mean(Abundance)`) %>%
filter(Cohort=="UAB"|Cohort=="Stanford",
`1_2`>0,
`3_4`>0) %>%
mutate(FoldChange=case_when(`1_2`>`3_4`~`1_2`/`3_4`,
`3_4`>`1_2`~-`3_4`/`1_2`)) #%>%
GFfoldChange <- GF2 %>%
filter(Clades==`1_2`|Clades==`3_4`) %>%
group_by(uniref, unirefAnnotation, Clades, Cohort) %>%
summarise(mean(Abundance)) %>%
ungroup() %>%
spread(Clades, `mean(Abundance)`) #%>%
GFfoldChange <- GF2 %>%
filter(Clades=="1_2"|Clades=="3_4") %>%
group_by(uniref, unirefAnnotation, Clades, Cohort) %>%
summarise(mean(Abundance)) %>%
ungroup() %>%
spread(Clades, `mean(Abundance)`) #%>%
GFfoldChange <- GF2 %>%
filter(Clades=="1_2"|Clades=="3_4") %>%
group_by(uniref, unirefAnnotation, Clades, Cohort) %>%
summarise(mean(Abundance)) %>%
ungroup() %>%
spread(Clades, `mean(Abundance)`) %>%
filter(Cohort=="UAB"|Cohort=="Stanford",
`1_2`>0,
`3_4`>0) %>%
mutate(FoldChange=case_when(`1_2`>`3_4`~`1_2`/`3_4`,
`3_4`>`1_2`~-`3_4`/`1_2`)) #%>%
labels1 <- GFfoldChange[order(GFfoldChange$FoldChange),] %>%
select(uniref, unirefAnnotation, Cohort, FoldChange)
labels1 <- labels1[1:20,]
labels2 <- GFfoldChange[order(-GFfoldChange$FoldChange),] %>%
select(uniref, unirefAnnotation, Cohort, FoldChange)
labels2 <- labels2[1:10,]
labels <- rbind(labels1, labels2) %>%
filter(unirefAnnotation!="NO_NAME")
ggplot(GFfoldChange, aes(x=uniref, y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "greater in `1_2", x=550, y = 500) +
annotate("text", label = "greater in 3_4",  x=500, y = -500)
geneFamilies <- unique(paste(GF2$uniref, GF2$unirefAnnotation, sep = ": "))
GFfoldChange <- GF2 %>%
filter(Clades=="1_2"|Clades=="3_4") %>%
group_by(uniref, unirefAnnotation, Clades, Cohort) %>%
summarise(mean(Abundance)) %>%
ungroup() %>%
spread(Clades, `mean(Abundance)`) %>%
filter(Cohort=="UAB"|Cohort=="Stanford",
`1_2`>0,
`3_4`>0) %>%
mutate(FoldChange=case_when(`1_2`>`3_4`~`1_2`/`3_4`,
`3_4`>`1_2`~-`3_4`/`1_2`)) #%>%
#  left_join(GFGO0, by="uniref") %>%  # for adding GO information to the dataframe. removed for now as multiple GO categories were assigned to many uniref
#  left_join(GOnames, by= "GO")
labels1 <- GFfoldChange[order(GFfoldChange$FoldChange),] %>%
select(uniref, unirefAnnotation, Cohort, FoldChange)
labels1 <- labels1[1:20,]
labels2 <- GFfoldChange[order(-GFfoldChange$FoldChange),] %>%
select(uniref, unirefAnnotation, Cohort, FoldChange)
labels2 <- labels2[1:10,]
labels <- rbind(labels1, labels2) %>%
filter(unirefAnnotation!="NO_NAME")
ggplot(GFfoldChange, aes(x=uniref, y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "greater in `1_2", x=550, y = 500) +
annotate("text", label = "greater in 3_4",  x=500, y = -500)
ggplot(GFfoldChange, aes(x=uniref, y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "greater in `1_2", x=100 y = 500) +
ggplot(GFfoldChange, aes(x=uniref, y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "greater in `1_2", x=100, y = 500) +
annotate("text", label = "greater in 3_4",  x=100, y = -500)
labels1 <- labels1[1:10,]
labels1 <- GFfoldChange[order(GFfoldChange$FoldChange),] %>%
select(uniref, unirefAnnotation, Cohort, FoldChange)
labels1 <- labels1[1:10,]
labels2 <- GFfoldChange[order(-GFfoldChange$FoldChange),] %>%
select(uniref, unirefAnnotation, Cohort, FoldChange)
labels2 <- labels2[1:10,]
labels <- rbind(labels1, labels2) %>%
filter(unirefAnnotation!="NO_NAME")
ggplot(GFfoldChange, aes(x=uniref, y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "greater in `1_2", x=100, y = 500) +
annotate("text", label = "greater in 3_4",  x=100, y = -500)
ggplot(GFfoldChange, aes(x=uniref, y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in `1_2", x=200, y = 6000)
ggplot(GFfoldChange, aes(x=uniref, y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=200, y = 6000)
ggplot(GFfoldChange, aes(x=reorder(uniref, FoldChange), y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=200, y = 6000)
ggplot(GFfoldChange, aes(x=uniref, y=FoldChange, label = unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
ggrepel::geom_text_repel(data=labels) +
labs(y=element_blank()) +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=200, y = 6000)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation))) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
GFfoldChangePath <- GFfoldChange %>%
left_join(GFP0, by=c("uniref", "unirefAnnotation")) %>%
filter(!is.na(Pathway)) %>%
left_join(PWnames, by="Pathway")
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation))) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
ggplot(GFfoldChangePath, aes(x=reorder(uniref, Pathway), y=FoldChange, color = paste(Pathway, pathwayAnnotation))) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation))) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation))) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort),
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation))) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort) +
ggrepel::geom_text_repel(labels=uniref) +
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation))) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort) +
ggrepel::geom_text_repel(labels=uniref)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), labels=uniref)) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort) +
ggrepel::geom_text_repel()
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=uniref)) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort) +
ggrepel::geom_text_repel()
View(GFfoldChangePath)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort) +
ggrepel::geom_text_repel(size=1)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_point() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort) +
ggrepel::geom_label_repel(size=3)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_text() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort) +
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_text() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort) +
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_text() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_text() +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_text(size=2) +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_text(size=2, show.legend = FALSE) +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
ggplot(GFfoldChangePath, aes(x=uniref, y=FoldChange, color = paste(Pathway, pathwayAnnotation), label=unirefAnnotation)) +
geom_text(size=2) +
theme(axis.text.x = element_blank()) +
labs(y=element_blank(), color="Pathway") +
facet_wrap(~Cohort)
GFfoldChange %>%
filter(FoldChange>=2000|FoldChange<=-1000) %>%
print(n = nrow(.), width = getOption("tibble.width"), n_extra = NULL)
alternatePresence <- GF2 %>%
group_by(uniref, unirefAnnotation, Clades, Cohort) %>%
summarise(mean(Abundance)) %>%
ungroup() %>%
spread(Clades, `mean(Abundance)`) %>%
filter(Cohort=="UAB"|Cohort=="Stanford",
`1_2`==0|`3_4`==0,
!(`1_2`==0&`3_4`==0)) %>%
mutate(`3_4`=-`3_4`) %>%
gather("Clades", "Abundance", c(`1_2`, `3_4`)) %>% #make abundance one column instead of separate T and P columsn
filter(Abundance!=0) %>% # get rid of duplicate entries where abundance = 0
left_join(GFP0, by=c("uniref", "unirefAnnotation")) %>%
left_join(PWnames, by="Pathway")
ggplot(alternatePresence, aes(x=reorder(uniref, Abundance), y=Abundance))+
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "greater in PTB", x=300, y = 25)
alternatePresence %>%
filter(Abundance>=10|Abundance<=10) %>%
ggplot(aes(x=reorder(uniref, Abundance), y=Abundance)) +
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "greater in PTB", x=300, y = 25)
ggplot(alternatePresence, aes(x=reorder(uniref, Abundance), y=Abundance))+
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=300, y = 25)
ggplot(alternatePresence, aes(x=reorder(uniref, Abundance), y=Abundance))+
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=300, y = 400)
alternatePresence %>%
filter(Abundance>=100|Abundance<=-30) %>%
ggplot(aes(x=reorder(uniref, Abundance), y=Abundance)) +
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=300, y = 25)
alternatePresence %>%
filter(Abundance>=100|Abundance<=-30) %>%
ggplot(aes(x=reorder(uniref, Abundance), y=Abundance)) +
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=3, y = 400)
alternatePresence %>%
filter(Abundance>=10|Abundance<=-20) %>%
arrange(-Abundance) %>%
print(n = nrow(.), width = getOption("tibble.width"), n_extra = NULL)
alternatePresence %>%
arrange(-Abundance) %>%
print(n = nrow(.), width = getOption("tibble.width"), n_extra = NULL)
alternatePresence %>%
filter(Abundance>=100|Abundance<=-30) %>%
arrange(-Abundance) %>%
print(n = nrow(.), width = getOption("tibble.width"), n_extra = NULL)
alternatePresence <- GF2 %>%
group_by(uniref, unirefAnnotation, Clades, Cohort) %>%
summarise(mean(Abundance)) %>%
ungroup() %>%
spread(Clades, `mean(Abundance)`) %>%
filter(Cohort=="UAB"|Cohort=="Stanford",
`1_2`==0|`3_4`==0,
!(`1_2`==0&`3_4`==0)) %>%
mutate(`3_4`=-`3_4`) %>%
gather("Clades", "Abundance", c(`1_2`, `3_4`)) %>% #make abundance one column instead of separate T and P columsn
filter(Abundance!=0) %>% # get rid of duplicate entries where abundance = 0
left_join(GFP0, by=c("uniref", "unirefAnnotation")) %>%
left_join(PWnames, by="Pathway")
ggplot(alternatePresence, aes(x=reorder(uniref, Abundance), y=Abundance))+
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=300, y = 400)
# remove bulk of the figure with little variation
alternatePresence %>%
filter(Abundance>=100|Abundance<=-30) %>%
ggplot(aes(x=reorder(uniref, Abundance), y=Abundance)) +
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=3, y = 400)
alternatePresence %>%
filter(Abundance>=80|Abundance<=-30) %>%
ggplot(aes(x=reorder(uniref, Abundance), y=Abundance)) +
geom_col() +
theme(axis.text.x = element_blank()) +
labs(x="Uniref90", y="Average reads per million") +
facet_wrap(~Cohort) +
annotate("text", label = "Positive=greater in 1/2", x=3, y = 400)
alternatePresence %>%
filter(Abundance>=800|Abundance<=-30) %>%
arrange(-Abundance) %>%
print(n = nrow(.), width = getOption("tibble.width"), n_extra = NULL)
map(pathways, ~filter(PA2, Pathway==.x) %>%
ggplot(., aes(x=Clades, y=Abundance, color=Clades)) +
geom_jitter() +
geom_boxplot(alpha=0) +
scale_y_log10() +
labs(title=.x, x=element_blank(), y="Abundance (reads per million") +
#scale_x_discrete(labels = c("Preterm", "Term")) +
scale_color_manual(values=c("#56B4E9", "#D55E00")) +
theme(legend.position = "none") +
facet_wrap(~Cohort))
pathways <- unique(PA2$Pathway)
pathways
map(pathways, ~filter(PA2, Pathway==.x) %>%
ggplot(., aes(x=Clades, y=Abundance, color=Clades)) +
geom_jitter() +
geom_boxplot(alpha=0) +
scale_y_log10() +
labs(title=.x, x=element_blank(), y="Abundance (reads per million") +
#scale_x_discrete(labels = c("Preterm", "Term")) +
scale_color_manual(values=c("#56B4E9", "#D55E00")) +
theme(legend.position = "none") +
facet_wrap(~Cohort))
map(pathways, ~filter(PA2, Pathway==.x) %>%
ggplot(., aes(x=Clades, y=Abundance, color=Clades)) +
geom_jitter() +
geom_boxplot(alpha=0) +
scale_y_log10() +
labs(title=.x, x=element_blank(), y="Abundance (reads per million") +
#scale_x_discrete(labels = c("Preterm", "Term")) +
#scale_color_manual(values=c("#56B4E9", "#D55E00")) +
theme(legend.position = "none") +
facet_wrap(~Cohort))
PC3 <- PC2 %>%
filter(Pathway!="UNINTEGRATED") # covereage value of "unintegrated" is meaningless
map(pathways[2:length(pathways)], ~filter(PC3, Pathway==.x) %>% # remove unintegrated from pathways list.
ggplot(., aes(x=Clades, y=Coverage, color=Clades)) +
geom_jitter() +
geom_boxplot(alpha=0) +
labs(title=.x, x=element_blank()) +
#scale_x_discrete(labels = c("Preterm", "Term")) +
ylim(0,1) +
#scale_color_manual(values=c("#56B4E9", "#D55E00")) +
theme(legend.position = "none") +
facet_wrap(~Cohort))
gardRelativeAbundance0 <- gardRelativeAbundance %>%
full_join(cladeFrame) %>%
group_by(SampleID, Clade) %>%
filter(n==max(n)) %>%
ungroup() %>%
select(-n) %>%
spread(Clade, propClade) %>%
mutate(Clades=case_when((`1`>0 |`2`>0) & `3`==0 & `4`==0 & `5`==0 & `6`==0 ~ "1_2",
`1`==0 & `2`==0 & (`3`>0 | `4`>0) & `5`==0 & `6`==0 ~ "3_4",
`1`==0 & `2`==0 & `3`==0 & `4`==0 & (`5`>0 | `6`>0) ~ "5_6",
`1` > 0 | `2` > 0 | `3`>0 | `4`>0 | `5`>0 | `6`>0 ~ "mix",
`1`==0 & `2` ==0 & `3`==0 & `4`==0 & `5`==0 & `6`==0 ~"none")) %>%
left_join(metaphlanGard, by="SampleID") %>%
left_join(unique.data.frame(sgDF[,c("SampleID", "SubjectID", "TermPre", "GWdell", "Cohort", "GWcoll")])) %>%
mutate(SubjectID=as.character(SubjectID))
pathways <- unique(PA2$Pathway)
pathways
map(pathways, ~filter(PA2, Pathway==.x) %>%
ggplot(., aes(x=Clades, y=Abundance, color=Clades)) +
geom_jitter() +
geom_boxplot(alpha=0) +
scale_y_log10() +
labs(title=.x, x=element_blank(), y="Abundance (reads per million") +
#scale_x_discrete(labels = c("Preterm", "Term")) +
#scale_color_manual(values=c("#56B4E9", "#D55E00")) +
theme(legend.position = "none") +
facet_wrap(~Cohort))
PA0 <- PA %>%
filter(str_detect(`# Pathway`, "Gardnerella")) %>%
as.data.frame()
rownames(PA0) <- PA0[,1]
PA1 <- PA0 %>%
select(-`# Pathway`)
PA2 <- PA1 %>%
t() %>%
as.data.frame(strinsAsFactors=FALSE) %>%
mutate(SampleID=str_extract(colnames(PA1), "[0-9]{10}")) %>%
gather("Pathway", "Abundance", contains("Gardnerella")) %>%
mutate(Pathway=str_extract(Pathway, ".*(?=.g__Gardnerella)")) %>%
left_join(gardRelativeAbundance0[,c("SampleID", "SubjectID", "TermPre", "GWdell", "GWcoll", "Cohort", "Clades")], by="SampleID")
head(PA2)
PC0 <- PC %>%
filter(str_detect(`# Pathway`, "Gardnerella")) %>%
as.data.frame()
rownames(PC0) <- PC0[,1]
PC1 <- PC0 %>%
select(-`# Pathway`)
PC2 <- PC1 %>%
t() %>%
as.data.frame(strinsAsFactors=FALSE) %>%
mutate(SampleID=str_extract(colnames(PC1), "[0-9]{10}")) %>%
gather("Pathway", "Coverage", contains("Gardnerella")) %>%
mutate(Pathway=str_extract(Pathway, ".*(?=.g__Gardnerella)")) %>%
left_join(gardRelativeAbundance0[,c("SampleID", "SubjectID", "TermPre", "GWdell", "GWcoll", "Cohort", "Clades")], by="SampleID")
head(PC2)
PC3 <- PC2 %>%
filter(Pathway!="UNINTEGRATED") # covereage value of "unintegrated" is meaningless
map(pathways[2:length(pathways)], ~filter(PC3, Pathway==.x) %>% # remove unintegrated from pathways list.
ggplot(., aes(x=Clades, y=Coverage, color=Clades)) +
geom_jitter() +
geom_boxplot(alpha=0) +
labs(title=.x, x=element_blank()) +
#scale_x_discrete(labels = c("Preterm", "Term")) +
ylim(0,1) +
#scale_color_manual(values=c("#56B4E9", "#D55E00")) +
theme(legend.position = "none") +
facet_wrap(~Cohort))
pathways <- unique(PA2$Pathway)
pathways
map(pathways, ~filter(PA2, Pathway==.x) %>%
ggplot(., aes(x=Clades, y=Abundance, color=Clades)) +
geom_jitter() +
geom_boxplot(alpha=0) +
scale_y_log10() +
labs(title=.x, x=element_blank(), y="Abundance (reads per million") +
#scale_x_discrete(labels = c("Preterm", "Term")) +
#scale_color_manual(values=c("#56B4E9", "#D55E00")) +
theme(legend.position = "none") +
facet_wrap(~Cohort))
