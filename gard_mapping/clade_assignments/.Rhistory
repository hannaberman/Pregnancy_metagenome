fastq_names_20 <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") #%>%
fastq_names_20
str_extract(pattern="[0-9](?<=_FgardRef_1.fastq)")
fastq_names_20 <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9](?<=_FgardRef_1.fastq)")
fastq_names_20
fastq_names_20 <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9](?<=_FgardRef_1.fastq.gz)")
fastq_names_20
fastq_names_20 <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9](?<=_FgardRef_1.fastq.gz)")
fastq_names_20
fastq_names_20 <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_names_20
fastq_20_files <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_42_files <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_20 <- lapply(fastq_20_files, readDNAStringSet, format="fastq")
names(fastq_20) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_42 <- lapply(fastq_42_files, readDNAStringSet, format="fastq")
names(fastq_42) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
n20 <- sapply(fastq_20, length)
n42 <- sapply(fastq_42, length)
n20
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20"
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42"
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
fastq_20_files <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_42_files <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_20 <- lapply(fastq_20_files, readDNAStringSet, format="fastq")
names(fastq_20) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_42 <- lapply(fastq_42_files, readDNAStringSet, format="fastq")
names(fastq_42) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
n20 <- sapply(fastq_20, length)
n42 <- sapply(fastq_42, length)
n20 <- sapply(fastq_20, length)
hist(n20)
n42 <- sapply(fastq_42, length)
hist(n42)
n20 <- sapply(fastq_20, length) %>%
as.data.frame()
n20
?as.data.frame
n20 <- sapply(fastq_20, length) %>%
base::as.data.frame(col.names=c("Sample", "n"))
n42 <- sapply(fastq_42, length) %>%
base::as.data.frame(col.names=c("Sample", "n"))
ggplot(data=n20, aes(x=as.character(Sample), y=n)) +
geom_dotplot() +
geom_boxplot()
n20 <- sapply(fastq_20, length) %>%
base::as.data.frame(col.names=c("Sample", "n"))
n42 <- sapply(fastq_42, length) %>%
base::as.data.frame(col.names=c("Sample", "n"))
ggplot(data=n20, aes(x=as.character(Sample), y=n)) +
geom_dotplot() +
geom_boxplot()
n20 <- sapply(fastq_20, length) %>%
base::as.data.frame(col.names=c("Sample", "n"))
n42 <- sapply(fastq_42, length) %>%
base::as.data.frame(col.names=c("Sample", "n"))
ggplot(data=n20, aes(x=as.character(n20$Sample), y=n)) +
geom_dotplot() +
geom_boxplot()
n20 <- sapply(fastq_20, length) %>%
base::as.data.frame(col.names="n") %>%
mutate(Sample=rownames(.))
n20
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(Sample=rownames(.))
n20
n20 <- sapply(fastq_20, length) %>%
as.data.frame() #%>%
n20
View(n20)
n20 <- sapply(fastq_20, length) %>%
as.data.frame(col.names="n") #%>%
View(n20)
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(Sample=rownames(n20))
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(Sample=rownames(n20)) %>%
rename(n=.)
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(Sample=rownames(n20)) %>%
rename(n=n20[,1])
colnames(n20)
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n20))
colnames(n20) <- c("n", "SampleID")
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n20))
n20 <- sapply(fastq_20, length) %>%
as.data.frame() #%>%
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n20))
colnames(n20) <- c("n", "SampleID")
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n20))
colnames(n20) <- c("n", "SampleID")
n42 <- sapply(fastq_42, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n42))
colnames(n42) <- c("n", "SampleID")
ggplot(data=n20, aes(x=as.character(n20$SampleID), y=n)) +
geom_dotplot() +
geom_boxplot()
View(42)
View(n42)
n_df <- data_frame(n20=fastq_20,
n42=fastq_42)
View(n_df)
n_df <- data.frame(n20=fastq_20,
n42=fastq_42)
fastq_20
n20 <- sapply(fastq_20, length) #%>%
n20
n_df <- data.frame(n20=sapply(fastq_20, length),
n42=sapply(fastq_42, length))
View(n_df)
n_df <- data.frame(n20=sapply(fastq_20, length),
n42=sapply(fastq_42, length)) %>%
mutate(SampleID=rownames(.))
n_df <- data.frame(n20=sapply(fastq_20, length),
n42=sapply(fastq_42, length)) %>%
mutate(SampleID=rownames(.)) %>%
gather("Threshold", "n", 1:2)
ggplot(data=n_df, aes(x=Threshold, y=n)) +
geom_dotplot() +
geom_boxplot()
ggplot(data=n_df, aes(y=n, x=Threshold)) +
geom_dotplot() +
geom_boxplot()
ggplot(data=n_df, aes(y=n_df$n, x=Threshold)) +
geom_dotplot() +
geom_boxplot()
ggplot(data=n_df, aes(y=n_df$n, x=Threshold)) +
geom_point() +
geom_boxplot()
ggplot(data=n_df, aes(y=n_df$n, x=Threshold)) +
geom_point() #+
ggplot(data=n_df, aes(y=n_df$n, x=Threshold)) +
geom_jitter() #+
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
n_df <- data.frame(n20=sapply(fastq_20, length),
n42=sapply(fastq_42, length)) %>%
mutate(SampleID=rownames(.))
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
fastq_20_filesp <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_42_filesp <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_20_filess <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_42_filess <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_20p <- lapply(fastq_20_filesp, readDNAStringSet, format="fastq")
names(fastq_20p) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_20s <- lapply(fastq_20_filess, readDNAStringSet, format="fastq")
names(fastq_20s) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_S.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_42p <- lapply(fastq_42_filesp, readDNAStringSet, format="fastq")
names(fastq_42p) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_42s <- lapply(fastq_42_filess, readDNAStringSet, format="fastq")
names(fastq_42s) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_S.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
remove(fastq_20)
remove(fastq_42)
n_df <- data.frame(n20p=sapply(fastq_20p, length),
n20s=sapply(fastq_20s, length),
n42p=sapply(fastq_42p, length),
n42s=sapply(fastq_42s, length)) %>%
mutate(SampleID=rownames(.),
n20=n20p+n20s,
n42=n42p+n42s)
n_df <- data.frame(n20p=sapply(fastq_20p, length),
n20s=sapply(fastq_20s, length),
n42p=sapply(fastq_42p, length),
n42s=sapply(fastq_42s, length)) %>%
mutate(SampleID=rownames(.),
n20=n20p+n20s,
n42=n42p+n42s)
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
n_df0 <- n_df %>%
select(SampleID, n20, n42)
gather("Threshold", "n", 2:3)
n_df <- data.frame(n20p=sapply(fastq_20p, length),
n20s=sapply(fastq_20s, length),
n42p=sapply(fastq_42p, length),
n42s=sapply(fastq_42s, length)) %>%
mutate(SampleID=rownames(.),
n20=n20p+n20s,
n42=n42p+n42s)
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
n_df0 <- n_df %>%
select(SampleID, n20, n42) %>%
gather("Threshold", "n", 2:3)
ggplot(data=n_df0, aes(y=n_df$n, x=Threshold)) +
geom_jitter() #+
View(n_df0)
n_df <- data.frame(n20p=sapply(fastq_20p, length),
n20s=sapply(fastq_20s, length),
n42p=sapply(fastq_42p, length),
n42s=sapply(fastq_42s, length)) %>%
mutate(SampleID=rownames(.),
n20=n20p+n20s,
n42=n42p+n42s)
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
n_df0 <- n_df %>%
select(SampleID, n20, n42) %>%
gather("Threshold", "n", 2:3)
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() #+
geom_boxplot()
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot()
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center") +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", size=1) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", bins=100) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", stat_bindot(bins=100)) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center") +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center") +
stat_bin(bins=50) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 20) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 30) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 1000) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 100) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 1) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 1) +
labs(y="reads") +
geom_crossbar()
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 500) +
labs(y="reads") +
geom_()
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 500) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 1000) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(fill=element_blank())
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(fill="none")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(alpha=1)
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(alpha=0.8)
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(alpha=0)
length(n_df0$n20==0)
length(n_df0$n42==0)
library(tidyverse); packageVersion("tidyverse")
#library(GenomicAlignments);packageVersion("GenomicAlignments")
library(Biostrings)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20"
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42"
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
fastq_20_filesp <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_42_filesp <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_20_filess <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_42_filess <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_20p <- lapply(fastq_20_filesp, readDNAStringSet, format="fastq")
library(tidyverse); packageVersion("tidyverse")
#library(GenomicAlignments);packageVersion("GenomicAlignments")
library(Biostrings)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20"
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42"
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
fastq_20_filesp <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_42_filesp <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_20_filess <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_42_filess <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_20p <- lapply(fastq_20_filesp, readDNAStringSet, format="fastq")
names(fastq_20p) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9]+(?=_FgardRef_1.fastq.gz)")
fastq_20s <- lapply(fastq_20_filess, readDNAStringSet, format="fastq")
names(fastq_20s) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_S.fastq.gz") %>%
str_extract(pattern="[0-9]+(?=_FgardRef_1.fastq.gz)")
fastq_42p <- lapply(fastq_42_filesp, readDNAStringSet, format="fastq")
names(fastq_42p) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9]+(?=_FgardRef_1.fastq.gz)")
fastq_42s <- lapply(fastq_42_filess, readDNAStringSet, format="fastq")
names(fastq_42s) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_S.fastq.gz") %>%
str_extract(pattern="[0-9]+(?=_FgardRef_1.fastq.gz)")
library(tidyverse)
library(Biostrings)
library(BiocParallel)
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDF_path <- file.path(repo_dir, "filter_host", "fastq_counts.txt")
sg_df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
krakenReads <- read_delim(file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv"), delim="\t")
#Load
sg_df <- read_delim(sg_df_path, delim = "\t")
countsDF <- read_delim(countsDF_path, delim="\ ")
countsDF0 <- countsDF %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2+uploadCountS,
filteredTotal=filteredCount1+filteredCount2+filteredCountS,
pctFiltered=filteredTotal/uploadTotal,
pctHuman2=(uploadTotal-filteredTotal)/uploadTotal,
SampleID=Sample)
sg_df0 <- sg_df %>%
left_join(., countsDF0[,c("SampleID", "pctHuman2")], by="SampleID") %>%
left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
mutate(difference=abs(pctHuman2-PctHuman),
differenceK=abs(pctHuman2-krakenHuAbundance))
sapply(list(upload=sg_df0$PctHuman, hannaBowtie=sg_df0$pctHuman2, kracken=sg_df0$krakenHuAbundance, difference1=sg_df0$difference, differenceKracken=sg_df0$differenceK), summary)
ggplot(sg_df0) +
geom_line(aes(x=as.character(SampleID), y=PctHuman, group=1), color = "black", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=krakenHuAbundance,group=1), color="blue", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=pctHuman2,group=1), color="red", show.legend = TRUE) +
theme(axis.text.x = element_blank())+
labs(title ="black:upload, red:Hanna Bowtie, blue:kraken", x="Sample", y="Proportion Human Reads")
View(sg_df0)
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDF_path <- file.path(repo_dir, "filter_host", "fastq_counts.txt")
sg_df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
krakenReads <- read_delim(file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv"), delim="\t")
#Load
sg_df <- read_delim(sg_df_path, delim = "\t")
countsDF <- read_delim(countsDF_path, delim="\ ")
countsDF0 <- countsDF %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2+uploadCountS,
filteredTotal=filteredCount1+filteredCount2+filteredCountS,
pctFiltered=filteredTotal/uploadTotal,
pctHuman2=(uploadTotal-filteredTotal)/uploadTotal,
SampleID=Sample)
sg_df0 <- sg_df %>%
left_join(., countsDF0[,c("SampleID", "pctHuman2")], by="SampleID") %>%
left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
mutate(difference=abs(pctHuman2-PctHuman),
differenceK=abs(pctHuman2-krakenHuAbundance))
sapply(list(upload=sg_df0$PctHuman, hannaBowtie=sg_df0$pctHuman2, kracken=sg_df0$krakenHuAbundance, difference1=sg_df0$difference, differenceKracken=sg_df0$differenceK), summary)
ggplot(sg_df0) +
geom_line(aes(x=as.character(SampleID), y=PctHuman, group=1), color = "black", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=krakenHuAbundance,group=1), color="blue", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=pctHuman2,group=1), color="red", show.legend = TRUE) +
theme(axis.text.x = element_blank())+
labs(title ="black:upload, red:Hanna Bowtie, blue:kraken", x="Sample", y="Proportion Human Reads")
View(countsDF)
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDF_path <- file.path(repo_dir, "filter_host", "fastq_counts.txt")
sg_df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
krakenReads <- read_delim(file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv"), delim="\t")
#Load
sg_df <- read_delim(sg_df_path, delim = "\t")
countsDF <- read_delim(countsDF_path, delim="\ ")
countsDF0 <- countsDF %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2+uploadCountS,
filteredTotal=filteredCount1+filteredCount2+filteredCountS,
pctFiltered=filteredTotal/uploadTotal,
pctHuman2=(uploadTotal-filteredTotal)/uploadTotal,
SampleID=Sample)
sg_df0 <- sg_df %>%
left_join(., countsDF0[,c("SampleID", "pctHuman2")], by="SampleID") %>%
left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
mutate(difference=abs(pctHuman2-PctHuman),
differenceK=abs(pctHuman2-krakenHuAbundance))
sapply(list(upload=sg_df0$PctHuman, hannaBowtie=sg_df0$pctHuman2, kracken=sg_df0$krakenHuAbundance, difference1=sg_df0$difference, differenceKracken=sg_df0$differenceK), summary)
ggplot(sg_df0) +
geom_line(aes(x=as.character(SampleID), y=PctHuman, group=1), color = "black", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=krakenHuAbundance,group=1), color="blue", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=pctHuman2,group=1), color="red", show.legend = TRUE) +
theme(axis.text.x = element_blank())+
labs(title ="black:upload, red:Hanna Bowtie, blue:kraken", x="Sample", y="Proportion Human Reads")
library(tidyverse); packageVersion("tidyverse")
#library(GenomicAlignments);packageVersion("GenomicAlignments")
library(Biostrings)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20" #fastsq files filtered by bowtie
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42" #fastq files filtered by bowtie
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
usearchAlns20 <- "/Users/hlbmeran/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns"
usearchAlns40 <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns42"
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE)
alns
usearchAlns20
list.files(usearchAlns20)
list.files(usearchAlns42)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20" #fastsq files filtered by bowtie
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42" #fastq files filtered by bowtie
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
usearchAlns20 <- "/Users/hlbmeran/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns"
usearchAlns42 <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns42"
list.files(usearchAlns42)
list.files(usearchAlns20)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20" #fastsq files filtered by bowtie
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42" #fastq files filtered by bowtie
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
usearchAlns20 <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns"
usearchAlns42 <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns42"
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE)
alns
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE) %>%
map(read_delim) #read in blast tables
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE) %>%
map(read_delim, delim="\t", stringsAsFactors=FALSE) #read in blast tables
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE) %>%
map(read_delim, delim="\t") #read in blast tables
save(alns, "/Users/hlberman/Desktop/alns.Rdata")
?save
save(alns, file="/Users/hlberman/Desktop/alns.Rdata")
View(alns[1])
?read_delim
View(alns[2])
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE) %>%
map(read_delim, delim="\t", col_names=c("query", "reference", "pcntid", "length", "mismatch", "gap_open", "qstart", "qend", "rstart", "rend", "evalue", "bitscore")) #read in blast tables
