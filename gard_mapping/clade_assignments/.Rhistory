allHits <- alns0 %>%
map2(., names(alns), ~mutate(.x, sampleID=.y)) %>%
map(~select(.x, sampleID, query, reference, Annotation, Strain, Clade, pcntid, length)) %>%
purrr::reduce(full_join, by=c("sampleID", "query", "reference", "Annotation", "Strain", "Clade", "pcntid", "length")) %>%
mutate(sampleID=as.character(sampleID))
#reference by annotation
#violin plot of each ref gene by annotation
ggplot(data = allHits, aes(pcntid)) +
geom_histogram(binwidth = 1) +
theme_classic() +
labs(title = "Percent ID of all hits", x = "Percent ID")
#ggsave(file.path(gdrive_path, "figures","hitID_hist.pdf"))
ggplot(data=allHits, aes(x=Annotation, y=pcntid))+
geom_violin() +
theme(axis.text.x = element_text(angle=45, hjust=1)) +
scale_y_continuous(breaks = seq(0, 100, by = 2.5)) +
labs(y="Percent ID")
#ggsave(file.path(gdrive_path, "figures","hitID_violinByAnno.pdf"), height = 8, width = 11)
ggplot(data=allHits, aes(x=sampleID, y=pcntid)) +
geom_violin() +
theme(axis.text.x = element_text(angle=45, hjust=1)) +
scale_y_continuous(breaks = seq(0, 100, by = 2.5)) +
labs(y="Percent ID")
#ggsave(file.path(gdrive_path, "figures","hitID_violinBySample.pdf"), height = 8, width = 11)
maxByQuery <- alns %>%  #max percent of ID of alignments per query
map(~group_by(.x, query)) %>%
map(~summarise(.x, maxbyquery=max(pcntid))) %>%
map(~ungroup(.x)) %>%
map2(., names(alns), ~mutate(.x, sampleID=.y)) %>%
purrr::reduce(full_join, by=c("query", "maxbyquery", "sampleID"))
ggplot(data = maxByQuery, aes(maxbyquery)) +
geom_histogram(binwidth = 1) +
theme_classic() +
labs(title = "Max percent ID per read", x = "Percent ID")
#ggsave(file.path(gdrive_path, "figures","maxIDperQuery_hist.pdf"))
maxByReference <- alns %>%  #max percent ID of alignments per reference (within each sample)
map(~group_by(.x, reference)) %>%
map(~summarise(.x, maxbyreference =max(pcntid))) %>%
map(~ungroup(.x)) %>%
map2(., names(alns), ~mutate(.x, sampleID=.y)) %>%
purrr::reduce(full_join, by=c("reference", "maxbyreference", "sampleID"))
ggplot(data = maxByReference, aes(maxbyreference)) +
geom_histogram(binwidth = 1) +
theme_classic() +
labs(title = "Max percent ID per reference (per sample)", x = "Percent ID")
#ggsave(file.path(gdrive_path, "figures","maxIDperRef_hist.pdf"))
maxByAnnotation <- alns0 %>% #max percentID
map(~group_by(.x, Annotation)) %>%
map(~summarise(.x, maxbyannotation =max(pcntid))) %>%
map(~ungroup(.x)) %>%
map2(., names(alns), ~mutate(.x, sampleID=.y)) %>%
purrr::reduce(full_join, by=c("Annotation", "maxbyannotation", "sampleID"))
ggplot(data = maxByAnnotation, aes(maxbyannotation)) +
geom_histogram(binwidth = 1) +
theme_classic() +
labs(title = "Max percent ID per annotation (per sample)", x = "Percent ID")
#ggsave(file.path(gdrive_path, "figures","maxIDperAnno_hist.pdf"))
sumStats2 <- sapply(list(PercentID=allHits$pcntid,
Max_by_query=maxByQuery$maxbyquery,
Max_by_reference=maxByReference$maxbyreference,
Max_by_annotation=maxByAnnotation$maxbyannotation),
summary) %>%
as.data.frame()
sumStats2
#write_csv(sumStats2, file.path(gdrive_path, "figures", "summaryStats2_maxIDs.csv"))
alns99 <- alns0 %>%
map(~filter(.x, pcntid>=99))
countCladesBySample99 <- alns99 %>%  #get count of clades mapped in each sample
map_df(~summarise(.x, nClades=n_distinct(Clade))) %>%
mutate(SampleID=names(alns)) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll")])
ggplot(data = countCladesBySample99, aes(nClades)) +
geom_histogram() +
theme_classic() +
scale_y_continuous(breaks = seq(0, 100, by = 10)) +
labs(title = "Number of clades found in each sample (filter to %ID>=99)", x = "# clades")
#ggsave(file.path(gdrive_path, "figures","cladesPerSample99.pdf"))
sample99clades <- alns99 %>%
map(~count(.x, Clade)) %>%
map(~mutate(.x, propClade=(n/sum(n)),
Clade=as.character(Clade))) %>%
map2(., names(alns99), ~mutate(.x, SampleID=.y)) %>%
purrr::reduce(full_join, by=c("SampleID", "Clade", "propClade")) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll")])
ggplot(data=sample99clades, aes(x=GWcoll, y=propClade, color = Clade)) +
geom_point()+
geom_jitter()+
facet_wrap(~SubjectID) +
labs(title = "Proportion clades found in each sample (filter to %ID>=99)", y="Proportion alignments per clade", x="Gestation Weeks")+
theme(axis.text.y = element_text(size=7))
#ggsave(file.path(gdrive_path, "figures","proportionCladesPerSample99.pdf"))
alns100 <- alns0 %>%
map(~filter(.x, pcntid==100))
countCladesBySample100 <- alns100 %>%  #get count of clades mapped in each sample
map_df(~summarise(.x, nClades=n_distinct(Clade))) %>%
mutate(SampleID=names(alns)) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll")])
ggplot(data = countCladesBySample100, aes(nClades)) +
geom_histogram() +
theme_classic() +
scale_y_continuous(breaks = seq(0, 100, by = 10)) +
labs(title = "Number of clades found in each sample (filter to %ID=100)", x = "# clades")
#ggsave(file.path(gdrive_path, "figures","cladesPerSample100.pdf"))
sample100clades <- alns100 %>%
map(~count(.x, Clade)) %>%
map(~mutate(.x, propClade=(n/sum(n)),
Clade=as.character(Clade))) %>%
map2(., names(alns100), ~mutate(.x, SampleID=.y)) %>%
purrr::reduce(full_join, by=c("SampleID", "Clade", "propClade")) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll")])
ggplot(data=sample100clades, aes(x=GWcoll, y=propClade, color = Clade)) +
geom_point()+
geom_jitter()+
facet_wrap(~SubjectID) +
labs(title = "Proportion clades found in each sample (filter to %ID=100)", y="Proportion alignments per clade", x="Gestation Weeks")+
theme(axis.text.y = element_text(size=7))
#ggsave(file.path(gdrive_path, "figures","proportionCladesPerSample100.pdf"))
alns99top <- alns0 %>%
map(~filter(.x, pcntid>=99)) %>%
map(~group_by(.x, query)) %>%
map(~filter(.x, pcntid==max(pcntid))) %>%
map(~ungroup(.x))
countCladesBySample99top <- alns99top %>%  #get count of clades mapped in each sample
map_df(~summarise(.x, nClades=n_distinct(Clade))) %>%
mutate(SampleID=names(alns)) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll")], by="SampleID")
ggplot(data = countCladesBySample99top, aes(nClades)) +
geom_histogram() +
theme_classic() +
scale_y_continuous(breaks = seq(0, 100, by = 10)) +
labs(title = "Number of clades found in each sample (filter to% ID>=99% (top hits only))", x = "# clades")
#ggsave(file.path(gdrive_path, "figures","cladesPerSample99top.pdf"))
sample99topclades <- alns99top %>%
map(~count(.x, Clade)) %>%
map(~mutate(.x, propClade=(n/sum(n)),
Clade=as.character(Clade))) %>%
map2(., names(alns99top), ~mutate(.x, SampleID=.y)) %>%
purrr::reduce(full_join, by=c("SampleID", "Clade", "propClade")) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll")])
ggplot(data=sample99topclades, aes(x=GWcoll, y=propClade, color = Clade)) +
geom_point()+
geom_jitter()+
facet_wrap(~SubjectID) +
labs(title = "Proportion clades found in each sample (filter to %ID>=99% (top hits only))", y="Proportion alignments per clade", x="Gestation Weeks")+
theme(axis.text.y = element_text(size=7))
#ggsave(file.path(gdrive_path, "figures","proportionCladesPerSample99top.pdf"))
hitsPerSample99 <- alns99 %>%
map(~nrow(.x)) %>%
as_tibble() %>%
t() %>%
as_tibble() %>%
mutate(SampleID=names(alns99))
ggplot(data = hitsPerSample99, aes(V1))+
geom_histogram(binwidth = 300) +
labs(title="hits per sample >= 99% id", x="hits") +
theme_classic()
summary(hitsPerSample99$V1)
duplicateReferences99 <- alns99 %>%  # dataframes with multiples only
map(~group_by(.x, query)) %>%
map(~filter(.x, n()>1)) %>%
map(~ungroup(.x))
diffClades99 <- duplicateReferences99 %>%
map(~select(.x, query, SampleID, Annotation, Clade)) %>%
purrr::reduce(full_join, by=c("query", "SampleID", "Annotation", "Clade")) %>%
group_by(query) %>%
filter(n_distinct(Clade)>1) %>%
ungroup()
ambiguous99 <-table(diffClades99$Annotation, diffClades99$Clade)
ambiguous99
#write.csv(as.data.frame(unclass(ambiguous99)), file.path(gdrive_path, "ambiguousHits99.csv"))
alns099 <- alns99 %>%
map(~select(.x, query, SampleID, SubjectID, GWcoll, RNAlater, PaperCohort, Annotation, Clade)) %>%
map(~unique.data.frame(.x)) %>%
purrr::reduce(full_join, by= c("query", "SampleID", "SubjectID", "GWcoll", "RNAlater", "PaperCohort", "Annotation", "Clade"))
ggplot(data=alns099) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
facet_wrap(~SampleID) +
theme_classic() +
theme(axis.text.x = element_text(angle=90, size=2)) +
labs(title = "Hits by Annotation (99% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "annotationBarPlot99.pdf"), width=30, height=20)
#let's zoom in on a few samples
#4009035268
`4009035268` <- alns099 %>%
filter(SampleID=="4009035268")
ggplot(data=`4009035268`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4009035268 (99%+ ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4009035268annotationBarPlot99.pdf"))
#1061635208
`1061635208` <- alns099 %>%
filter(SampleID=="1061635208")
ggplot(data=`1061635208`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 1061635208 (99%+ ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "1061635208annotationBarPlot99.pdf"))
#4002101198
`4002101198` <- alns099 %>%
filter(SampleID=="4002101198")
ggplot(data=`4002101198`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4002101198 (99%+ ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4002101198annotationBarPlot99.pdf"))
#4002101298
`4002101298` <- alns099 %>%
filter(SampleID=="4002101298")
ggplot(data=`4002101298`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4002101298 (99%+ ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4002101298annotationBarPlot99.pdf"))
#4007535358
`4007535358` <- alns099 %>%
filter(SampleID=="4007535358")
ggplot(data=`4007535358`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4007535358 (99%+ ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4007535358annotationBarPlot99.pdf"))
hitsPerSample100 <- alns100 %>%
map(~nrow(.x)) %>%
as_tibble() %>%
t() %>%
as_tibble() %>%
mutate(SampleID=names(alns100))
ggplot(data = hitsPerSample100, aes(V1))+
geom_histogram(binwidth = 300) +
labs(title="hits per sample = 100% id", x="hits") +
theme_classic()
summary(hitsPerSample100$V1)
duplicateReferences100 <- alns100 %>%  # dataframes with multiples only
map(~group_by(.x, query)) %>%
map(~filter(.x,n()>1)) %>%
map(~ungroup(.x))
diffClades100 <- duplicateReferences100 %>%
map(~select(.x, query, SampleID, Annotation, Clade)) %>%
purrr::reduce(full_join, by=c("query", "SampleID", "Annotation", "Clade")) %>%
group_by(query) %>%
filter(n_distinct(Clade)>1) %>%
ungroup()
ambiguous100 <- table(diffClades100$Annotation, diffClades100$Clade)
ambiguous100
#write.csv(as.data.frame(unclass(ambiguous100)), file.path(gdrive_path, "ambiguousHits100.csv"))
alns0100 <- alns100 %>%
map(~select(.x, query, SampleID, SubjectID, GWcoll, RNAlater, PaperCohort, Annotation, Clade)) %>%
map(~unique.data.frame(.x)) %>%
purrr::reduce(full_join, by= c("query", "SampleID", "SubjectID", "GWcoll", "RNAlater", "PaperCohort", "Annotation", "Clade"))
ggplot(data=alns0100) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
facet_wrap(~SampleID) +
theme_classic() +
theme(axis.text.x = element_text(angle=90, size=2)) +
labs(title = "Hits by Annotation (100% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "annotationBarPlot100.pdf"), width=30, height=20)
#let's zoom in on a few samples
#4009035268
`4009035268` <- alns0100 %>%
filter(SampleID=="4009035268")
ggplot(data=`4009035268`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4009035268 (100% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4009035268annotationBarPlot100.pdf"))
#1061635208
`1061635208` <- alns0100 %>%
filter(SampleID=="1061635208")
ggplot(data=`1061635208`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 1061635208 (100% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "1061635208annotationBarPlot100.pdf"))
#4002101198
`4002101198` <- alns0100 %>%
filter(SampleID=="4002101198")
ggplot(data=`4002101198`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4002101198 (100% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4002101198annotationBarPlot100.pdf"))
#4002101298
`4002101298` <- alns0100 %>%
filter(SampleID=="4002101298")
ggplot(data=`4002101298`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4002101298 (100% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4002101298annotationBarPlot100.pdf"))
#4007535358
`4007535358` <- alns0100 %>%
filter(SampleID=="4007535358")
ggplot(data=`4007535358`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4007535358 (100% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4007535358annotationBarPlot100.pdf"))
hitsPerSample99top <- alns99top %>%
map(~nrow(.x)) %>%
as_tibble() %>%
t() %>%
as_tibble() %>%
mutate(SampleID=names(alns99top))
ggplot(data = hitsPerSample99top, aes(V1))+
geom_histogram(binwidth = 300) +
labs(title="hits per sample >= 99% id (top hit only)", x="hits") +
theme_classic()
summary(hitsPerSample99top$V1)
duplicateReferences99top <- alns99top %>%  # dataframes with multiples only
map(~group_by(.x, query)) %>%
map(~filter(.x, n()>1)) %>%
map(~ungroup(.x))
diffClades99top_100 <- duplicateReferences99top %>%
map(~filter(.x, pcntid==100)) %>%
map(~select(.x, query, SampleID, Annotation, Clade)) %>%
purrr::reduce(full_join, by=c("query", "SampleID", "Annotation", "Clade")) %>%
group_by(query) %>%
filter(n_distinct(Clade)>1) %>%
ungroup()
ambiguous99top_100 <-table(diffClades99top_100$Annotation, diffClades99top_100$Clade)
print("ambiguous annotations with 100% id")
ambiguous99top_100
#write.csv(as.data.frame(unclass(ambiguous99top_100)), file.path(gdrive_path, "ambiguousHits99top_100.csv"))
diffClades99top_99 <- duplicateReferences99top %>%
map(~filter(.x, pcntid!=100)) %>%
map(~select(.x, query, SampleID, Annotation, Clade)) %>%
purrr::reduce(full_join, by=c("query", "SampleID", "Annotation", "Clade")) %>%
group_by(query) %>%
filter(n_distinct(Clade)>1) %>%
ungroup()
ambiguous99top_99 <-table(diffClades99top_99$Annotation, diffClades99top_99$Clade)
print("ambiguous annotations with ~99% id")
ambiguous99top_99
#write.csv(as.data.frame(unclass(ambiguous99top_99)), file.path(gdrive_path, "ambiguousHits99top_99.csv"))
alns099_top <- alns99top %>%
map(~select(.x, query, pcntid, SampleID, SubjectID, GWcoll, RNAlater, PaperCohort, Annotation, Clade)) %>%
map(~unique.data.frame(.x)) %>%
purrr::reduce(full_join, by= c("query", "pcntid", "SampleID", "SubjectID", "GWcoll", "RNAlater", "PaperCohort", "Annotation", "Clade"))
ggplot(data=alns099_top) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
facet_wrap(~SampleID) +
theme_classic() +
theme(axis.text.x = element_text(angle=90, size=2)) +
labs(title = "Hits by Annotation (top hit above 99% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "annotationBarPlot99top.pdf"), width=30, height=20)
#let's zoom in on a few samples
#4009035268
`4009035268` <- alns099_top %>%
filter(SampleID=="4009035268")
ggplot(data=`4009035268`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4009035268 (top hid >=99% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4009035268annotationBarPlot99top.pdf"))
#1061635208
`1061635208` <- alns099_top %>%
filter(SampleID=="1061635208")
ggplot(data=`1061635208`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 1061635208 (top hid >=99% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "1061635208annotationBarPlot99top.pdf"))
#4002101198
`4002101198` <- alns099_top %>%
filter(SampleID=="4002101198")
ggplot(data=`4002101198`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4002101198 (top hid >=99% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4002101198annotationBarPlot99top.pdf"))
#4002101298
`4002101298` <- alns099_top %>%
filter(SampleID=="4002101298")
ggplot(data=`4002101298`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4002101298 (top hid >=99% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4002101298annotationBarPlot99top.pdf"))
#4007535358
`4007535358` <- alns099_top %>%
filter(SampleID=="4007535358")
ggplot(data=`4007535358`) +
geom_bar(aes(x=Annotation, color=as.character(Clade), fill=as.character(Clade))) +
theme_classic() +
theme(axis.text.x = element_text(angle=45, hjust=1, size = 6)) +
labs(title = "Hits by Annotation Sample 4007535358 (top hid >=99% ID)", color="Clade", fill="Clade")
#ggsave(file.path(gdrive_path, "figures", "4007535358annotationBarPlot99top.pdf"))
#subjects with G. vaginalis per 16S data
subjects16S <- data.frame(SubjectID=c("40072", "10621", "40069", "10616", "19024", "40084", "10627", "10056", "10629", "40021", "40047", "40090", "40059", "40075", "40074", "40098", "10626", "40066", "40071", "20505", "40049", "40032", "40042", "10612", "10508", "10608", "10623"))
compare16S <- alns0100 %>%
filter(PaperCohort==2017,
Annotation!="30S ribosomal protein S15",
Annotation!="30S ribosomal protein S2",
Annotation!="50S ribosomal protein L31",
Annotation!="Glutamyl-tRNA(Gln) amidotransferase subunit C",
Annotation!="Phosphoglucomutase",
Annotation!="Pyruvate formate-lyase 1-activating enzyme",
Annotation!="Ribonucleoside-diphosphate reductase subunit beta nrdF2",
Annotation!="Transketolase",
Annotation!="Valine--tRNA ligase") %>%
group_by(SampleID) %>%
count(Clade) %>%
mutate(propClade=(n/sum(n)),
Clade=as.character(Clade)) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll", "RNAlater")], by="SampleID") %>%
full_join(sgDF["PaperCohort"==2017, "SampleID"], by="SampleID") %>%
full_join(subjects16S, by="SubjectID")
ggplot(data=compare16S, aes(x=GWcoll, y=propClade, color=Clade, shape=RNAlater)) +
geom_point() +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
labs(title = "Clade assignments by shotgun sequencing:\nFiltering at 100%ID", x= "Gestation weeks at collection", y="Proportion of Gardnerella", shape="RNA Later", color="Clade")
#ggsave(filename = file.path(gdrive_path, "cladesByShotgun100_filtered.pdf"))
ggplot(data=compare16S, aes(x=GWcoll, y=propClade, color=Clade, fill=Clade)) +
geom_bar(stat="identity") +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
scale_fill_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
labs(title = "Clade assignments by shotgun sequencing:\nFiltering at 100%ID", x= "Gestation weeks at collection", y="Proportion of Gardnerella", shape="RNA Later", color="Clade")
#ggsave(filename = file.path(gdrive_path, "cladesByShotgun100_filtered_bar.pdf"))
compare16S99 <- alns099 %>%
filter(PaperCohort==2017,
Annotation!="30S ribosomal protein S13",
Annotation!="30S ribosomal protein S15",
Annotation!="30S ribosomal protein S2",
Annotation!="50S ribosomal protein L1",
Annotation!="50S ribosomal protein L11",
Annotation!="50S ribosomal protein L3",
Annotation!="50S ribosomal protein L31",
Annotation!="Aspartyl/glutamyl-tRNA(Asn/Gln) amidotransferase subunit B",
Annotation!="ATP synthase subunit alpha",
Annotation!="CTP synthase",
Annotation!="DNA-directed RNA polymerase subunit beta",
Annotation!="Elongation factor G",
Annotation!="Glutamyl-tRNA(Gln) amidotransferase subunit A",
Annotation!="Glutamyl-tRNA(Gln) amidotransferase subunit C",
Annotation!="GTP-binding protein TypA/BipA",
Annotation!="Phosphoglucomutase",
Annotation!="Pyruvate formate-lyase 1-activating enzyme",
Annotation!="Ribonucleoside-diphosphate reductase subunit alpha 1",
Annotation!="Ribonucleoside-diphosphate reductase subunit beta nrdF2",
Annotation!="Threonine--tRNA ligase",
Annotation!="Transaldolase",
Annotation!="Transketolase",
Annotation!="Valine--tRNA ligase",
Annotation!="Vegetative protein 296") %>%
group_by(SampleID) %>%
count(Clade) %>%
mutate(propClade=(n/sum(n)),
Clade=as.character(Clade)) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll", "RNAlater")], by="SampleID") %>%
full_join(sgDF["PaperCohort"==2017, "SampleID"], by="SampleID") %>%
full_join(subjects16S, by="SubjectID")
ggplot(data=compare16S99, aes(x=GWcoll, y=propClade, color=Clade, shape=RNAlater)) +
geom_point() +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
labs(title = "Clade assignments by shotgun sequencing:\nFiltering at 99%ID", x= "Gestation weeks at collection", y="Proportion of Gardnerella", shape="RNA Later", color="Clade")
#ggsave(filename = file.path(gdrive_path, "cladesByShotgun99_filtered.pdf"))
ggplot(data=compare16S99, aes(x=GWcoll, y=propClade, color=Clade, fill=Clade)) +
geom_bar(stat = "identity") +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
scale_fill_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
labs(title = "Clade assignments by shotgun sequencing:\nFiltering at 99%ID", x= "Gestation weeks at collection", y="Proportion of Gardnerella", shape="RNA Later", color="Clade")
#ggsave(filename = file.path(gdrive_path, "cladesByShotgun99_filtered_bar.pdf"))
compare16S99top <- alns099_top %>%
filter(PaperCohort == 2017,
Annotation !="30S ribosomal protein S15",
Annotation !="30S ribosomal protein S2",
Annotation !="50S ribosomal protein L31",
Annotation !="Glutamyl-tRNA(Gln) amidotransferase subunit C",
Annotation !="Phosphoglucomutase",
Annotation !="Transketolase",
Annotation !="Pyruvate formate-lyase 1-activating enzyme" ,
Annotation !="Ribonucleoside-diphosphate reductase subunit beta nrdF2",
Annotation !="Valine--tRNA ligase") %>%
group_by(SampleID) %>%
count(Clade) %>%
mutate(propClade=(n/sum(n)),
Clade=as.character(Clade)) %>%
left_join(sgDF[,c("SampleID","SubjectID", "GWcoll", "RNAlater")], by="SampleID") %>%
full_join(sgDF["PaperCohort"==2017, "SampleID"], by="SampleID") %>%
full_join(subjects16S, by="SubjectID")
ggplot(data=compare16S99top, aes(x=GWcoll, y=propClade, color=Clade, shape=RNAlater)) +
geom_point() +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
labs(title = "Clade assignments by shotgun sequencing:\nFiltering top hits >=99%ID", x= "Gestation weeks at collection", y="Proportion of Gardnerella", shape="RNA Later", color="Clade")
ggsave(filename = file.path(gdrive_path, "cladesByShotgun99top_filtered.pdf"))
ggplot(data=compare16S99top, aes(x=GWcoll, y=propClade, color=Clade, fill=Clade)) +
geom_bar(stat = "identity") +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
scale_fill_manual(values=c("indianred1", "indianred3", "steelblue1", "steelblue3", "darkorchid2", "yellowgreen" )) +
labs(title = "Clade assignments by shotgun sequencing:\nFiltering top hits >=99%ID", x= "Gestation weeks at collection", y="Proportion of Gardnerella", shape="RNA Later", fill="Clade")
ggsave(filename = file.path(gdrive_path, "cladesByShotgun99top_filtered_bar.pdf"))
