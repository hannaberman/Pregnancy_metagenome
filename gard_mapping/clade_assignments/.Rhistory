n20
n20 <- sapply(fastq_20, length) %>%
as.data.frame() #%>%
n20
View(n20)
n20 <- sapply(fastq_20, length) %>%
as.data.frame(col.names="n") #%>%
View(n20)
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(Sample=rownames(n20))
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(Sample=rownames(n20)) %>%
rename(n=.)
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(Sample=rownames(n20)) %>%
rename(n=n20[,1])
colnames(n20)
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n20))
colnames(n20) <- c("n", "SampleID")
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n20))
n20 <- sapply(fastq_20, length) %>%
as.data.frame() #%>%
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n20))
colnames(n20) <- c("n", "SampleID")
n20 <- sapply(fastq_20, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n20))
colnames(n20) <- c("n", "SampleID")
n42 <- sapply(fastq_42, length) %>%
as.data.frame() %>%
mutate(SampleID=rownames(n42))
colnames(n42) <- c("n", "SampleID")
ggplot(data=n20, aes(x=as.character(n20$SampleID), y=n)) +
geom_dotplot() +
geom_boxplot()
View(42)
View(n42)
n_df <- data_frame(n20=fastq_20,
n42=fastq_42)
View(n_df)
n_df <- data.frame(n20=fastq_20,
n42=fastq_42)
fastq_20
n20 <- sapply(fastq_20, length) #%>%
n20
n_df <- data.frame(n20=sapply(fastq_20, length),
n42=sapply(fastq_42, length))
View(n_df)
n_df <- data.frame(n20=sapply(fastq_20, length),
n42=sapply(fastq_42, length)) %>%
mutate(SampleID=rownames(.))
n_df <- data.frame(n20=sapply(fastq_20, length),
n42=sapply(fastq_42, length)) %>%
mutate(SampleID=rownames(.)) %>%
gather("Threshold", "n", 1:2)
ggplot(data=n_df, aes(x=Threshold, y=n)) +
geom_dotplot() +
geom_boxplot()
ggplot(data=n_df, aes(y=n, x=Threshold)) +
geom_dotplot() +
geom_boxplot()
ggplot(data=n_df, aes(y=n_df$n, x=Threshold)) +
geom_dotplot() +
geom_boxplot()
ggplot(data=n_df, aes(y=n_df$n, x=Threshold)) +
geom_point() +
geom_boxplot()
ggplot(data=n_df, aes(y=n_df$n, x=Threshold)) +
geom_point() #+
ggplot(data=n_df, aes(y=n_df$n, x=Threshold)) +
geom_jitter() #+
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
n_df <- data.frame(n20=sapply(fastq_20, length),
n42=sapply(fastq_42, length)) %>%
mutate(SampleID=rownames(.))
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
fastq_20_filesp <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_42_filesp <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_20_filess <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_42_filess <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_20p <- lapply(fastq_20_filesp, readDNAStringSet, format="fastq")
names(fastq_20p) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_20s <- lapply(fastq_20_filess, readDNAStringSet, format="fastq")
names(fastq_20s) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_S.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_42p <- lapply(fastq_42_filesp, readDNAStringSet, format="fastq")
names(fastq_42p) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
fastq_42s <- lapply(fastq_42_filess, readDNAStringSet, format="fastq")
names(fastq_42s) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_S.fastq.gz") %>%
str_extract(pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9](?=_FgardRef_1.fastq.gz)")
remove(fastq_20)
remove(fastq_42)
n_df <- data.frame(n20p=sapply(fastq_20p, length),
n20s=sapply(fastq_20s, length),
n42p=sapply(fastq_42p, length),
n42s=sapply(fastq_42s, length)) %>%
mutate(SampleID=rownames(.),
n20=n20p+n20s,
n42=n42p+n42s)
n_df <- data.frame(n20p=sapply(fastq_20p, length),
n20s=sapply(fastq_20s, length),
n42p=sapply(fastq_42p, length),
n42s=sapply(fastq_42s, length)) %>%
mutate(SampleID=rownames(.),
n20=n20p+n20s,
n42=n42p+n42s)
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
n_df0 <- n_df %>%
select(SampleID, n20, n42)
gather("Threshold", "n", 2:3)
n_df <- data.frame(n20p=sapply(fastq_20p, length),
n20s=sapply(fastq_20s, length),
n42p=sapply(fastq_42p, length),
n42s=sapply(fastq_42s, length)) %>%
mutate(SampleID=rownames(.),
n20=n20p+n20s,
n42=n42p+n42s)
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
n_df0 <- n_df %>%
select(SampleID, n20, n42) %>%
gather("Threshold", "n", 2:3)
ggplot(data=n_df0, aes(y=n_df$n, x=Threshold)) +
geom_jitter() #+
View(n_df0)
n_df <- data.frame(n20p=sapply(fastq_20p, length),
n20s=sapply(fastq_20s, length),
n42p=sapply(fastq_42p, length),
n42s=sapply(fastq_42s, length)) %>%
mutate(SampleID=rownames(.),
n20=n20p+n20s,
n42=n42p+n42s)
sapply(list(n20=n_df$n20, n42=n_df$n42), summary)
n_df0 <- n_df %>%
select(SampleID, n20, n42) %>%
gather("Threshold", "n", 2:3)
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() #+
geom_boxplot()
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot()
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center") +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", size=1) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", bins=100) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", stat_bindot(bins=100)) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center") +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center") +
stat_bin(bins=50) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 20) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 30) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 1000) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 100) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 1) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 1) +
labs(y="reads") +
geom_crossbar()
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 500) +
labs(y="reads") +
geom_()
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 500) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 1000) +
labs(y="reads")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(fill=element_blank())
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(fill="none")
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(alpha=1)
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(alpha=0.8)
ggplot(data=n_df0, aes(y=n_df0$n, x=Threshold)) +
geom_jitter() +
labs(y="reads") +
geom_boxplot(alpha=0)
length(n_df0$n20==0)
length(n_df0$n42==0)
library(tidyverse); packageVersion("tidyverse")
#library(GenomicAlignments);packageVersion("GenomicAlignments")
library(Biostrings)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20"
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42"
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
fastq_20_filesp <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_42_filesp <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_20_filess <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_42_filess <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_20p <- lapply(fastq_20_filesp, readDNAStringSet, format="fastq")
library(tidyverse); packageVersion("tidyverse")
#library(GenomicAlignments);packageVersion("GenomicAlignments")
library(Biostrings)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20"
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42"
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
fastq_20_filesp <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_42_filesp <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_1.fastq.gz")
fastq_20_filess <- list.files(path=fastq_20_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_42_filess <- list.files(path=fastq_42_path, all.files = FALSE, full.names = TRUE, pattern = "_S.fastq.gz")
fastq_20p <- lapply(fastq_20_filesp, readDNAStringSet, format="fastq")
names(fastq_20p) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9]+(?=_FgardRef_1.fastq.gz)")
fastq_20s <- lapply(fastq_20_filess, readDNAStringSet, format="fastq")
names(fastq_20s) <- list.files(path=fastq_20_path, all.files = FALSE, full.names = FALSE, pattern = "_S.fastq.gz") %>%
str_extract(pattern="[0-9]+(?=_FgardRef_1.fastq.gz)")
fastq_42p <- lapply(fastq_42_filesp, readDNAStringSet, format="fastq")
names(fastq_42p) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_1.fastq.gz") %>%
str_extract(pattern="[0-9]+(?=_FgardRef_1.fastq.gz)")
fastq_42s <- lapply(fastq_42_filess, readDNAStringSet, format="fastq")
names(fastq_42s) <- list.files(path=fastq_42_path, all.files = FALSE, full.names = FALSE, pattern = "_S.fastq.gz") %>%
str_extract(pattern="[0-9]+(?=_FgardRef_1.fastq.gz)")
library(tidyverse)
library(Biostrings)
library(BiocParallel)
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDF_path <- file.path(repo_dir, "filter_host", "fastq_counts.txt")
sg_df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
krakenReads <- read_delim(file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv"), delim="\t")
#Load
sg_df <- read_delim(sg_df_path, delim = "\t")
countsDF <- read_delim(countsDF_path, delim="\ ")
countsDF0 <- countsDF %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2+uploadCountS,
filteredTotal=filteredCount1+filteredCount2+filteredCountS,
pctFiltered=filteredTotal/uploadTotal,
pctHuman2=(uploadTotal-filteredTotal)/uploadTotal,
SampleID=Sample)
sg_df0 <- sg_df %>%
left_join(., countsDF0[,c("SampleID", "pctHuman2")], by="SampleID") %>%
left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
mutate(difference=abs(pctHuman2-PctHuman),
differenceK=abs(pctHuman2-krakenHuAbundance))
sapply(list(upload=sg_df0$PctHuman, hannaBowtie=sg_df0$pctHuman2, kracken=sg_df0$krakenHuAbundance, difference1=sg_df0$difference, differenceKracken=sg_df0$differenceK), summary)
ggplot(sg_df0) +
geom_line(aes(x=as.character(SampleID), y=PctHuman, group=1), color = "black", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=krakenHuAbundance,group=1), color="blue", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=pctHuman2,group=1), color="red", show.legend = TRUE) +
theme(axis.text.x = element_blank())+
labs(title ="black:upload, red:Hanna Bowtie, blue:kraken", x="Sample", y="Proportion Human Reads")
View(sg_df0)
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDF_path <- file.path(repo_dir, "filter_host", "fastq_counts.txt")
sg_df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
krakenReads <- read_delim(file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv"), delim="\t")
#Load
sg_df <- read_delim(sg_df_path, delim = "\t")
countsDF <- read_delim(countsDF_path, delim="\ ")
countsDF0 <- countsDF %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2+uploadCountS,
filteredTotal=filteredCount1+filteredCount2+filteredCountS,
pctFiltered=filteredTotal/uploadTotal,
pctHuman2=(uploadTotal-filteredTotal)/uploadTotal,
SampleID=Sample)
sg_df0 <- sg_df %>%
left_join(., countsDF0[,c("SampleID", "pctHuman2")], by="SampleID") %>%
left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
mutate(difference=abs(pctHuman2-PctHuman),
differenceK=abs(pctHuman2-krakenHuAbundance))
sapply(list(upload=sg_df0$PctHuman, hannaBowtie=sg_df0$pctHuman2, kracken=sg_df0$krakenHuAbundance, difference1=sg_df0$difference, differenceKracken=sg_df0$differenceK), summary)
ggplot(sg_df0) +
geom_line(aes(x=as.character(SampleID), y=PctHuman, group=1), color = "black", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=krakenHuAbundance,group=1), color="blue", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=pctHuman2,group=1), color="red", show.legend = TRUE) +
theme(axis.text.x = element_blank())+
labs(title ="black:upload, red:Hanna Bowtie, blue:kraken", x="Sample", y="Proportion Human Reads")
View(countsDF)
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDF_path <- file.path(repo_dir, "filter_host", "fastq_counts.txt")
sg_df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
krakenReads <- read_delim(file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv"), delim="\t")
#Load
sg_df <- read_delim(sg_df_path, delim = "\t")
countsDF <- read_delim(countsDF_path, delim="\ ")
countsDF0 <- countsDF %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2+uploadCountS,
filteredTotal=filteredCount1+filteredCount2+filteredCountS,
pctFiltered=filteredTotal/uploadTotal,
pctHuman2=(uploadTotal-filteredTotal)/uploadTotal,
SampleID=Sample)
sg_df0 <- sg_df %>%
left_join(., countsDF0[,c("SampleID", "pctHuman2")], by="SampleID") %>%
left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
mutate(difference=abs(pctHuman2-PctHuman),
differenceK=abs(pctHuman2-krakenHuAbundance))
sapply(list(upload=sg_df0$PctHuman, hannaBowtie=sg_df0$pctHuman2, kracken=sg_df0$krakenHuAbundance, difference1=sg_df0$difference, differenceKracken=sg_df0$differenceK), summary)
ggplot(sg_df0) +
geom_line(aes(x=as.character(SampleID), y=PctHuman, group=1), color = "black", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=krakenHuAbundance,group=1), color="blue", show.legend = TRUE) +
geom_line(aes(x=as.character(SampleID), y=pctHuman2,group=1), color="red", show.legend = TRUE) +
theme(axis.text.x = element_blank())+
labs(title ="black:upload, red:Hanna Bowtie, blue:kraken", x="Sample", y="Proportion Human Reads")
library(tidyverse); packageVersion("tidyverse")
#library(GenomicAlignments);packageVersion("GenomicAlignments")
library(Biostrings)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20" #fastsq files filtered by bowtie
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42" #fastq files filtered by bowtie
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
usearchAlns20 <- "/Users/hlbmeran/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns"
usearchAlns40 <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns42"
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE)
alns
usearchAlns20
list.files(usearchAlns20)
list.files(usearchAlns42)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20" #fastsq files filtered by bowtie
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42" #fastq files filtered by bowtie
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
usearchAlns20 <- "/Users/hlbmeran/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns"
usearchAlns42 <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns42"
list.files(usearchAlns42)
list.files(usearchAlns20)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
gard_tree_dir <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/Gard WGS"
output_dir <- file.path(repo_dir, "gard_mapping/clade_assignments/")
df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
ref_df_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
fastq_20_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_20" #fastsq files filtered by bowtie
fastq_42_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/filtered_fastq_42" #fastq files filtered by bowtie
ref_db_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenes.fasta")
refGenesDF_path <- file.path(repo_dir, "gard_mapping/clade_assignments/ref_genes/refGenesDF.csv")
usearchAlns20 <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns"
usearchAlns42 <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG/gard_map/usearch_alns42"
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE)
alns
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE) %>%
map(read_delim) #read in blast tables
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE) %>%
map(read_delim, delim="\t", stringsAsFactors=FALSE) #read in blast tables
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE) %>%
map(read_delim, delim="\t") #read in blast tables
save(alns, "/Users/hlberman/Desktop/alns.Rdata")
?save
save(alns, file="/Users/hlberman/Desktop/alns.Rdata")
View(alns[1])
?read_delim
View(alns[2])
alns <- list.files(usearchAlns20, all.files = FALSE, full.names = TRUE) %>%
map(read_delim, delim="\t", col_names=c("query", "reference", "pcntid", "length", "mismatch", "gap_open", "qstart", "qend", "rstart", "rend", "evalue", "bitscore")) #read in blast tables
library(tidyverse)
library(phyloseq)
library(Biostrings)
library(tidyverse)
library(phyloseq)
library(Biostrings)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
sgDF_path <- file.path(repo_dir, "shotgunMetadata.tsv")
S16_path <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/vagMicrobiomeMetagenome/16S_data/RepRefine_Scripts/input/processed.rda"
#S16_path <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/methods_comparisons/PS_RData/16S_PS.RData"
load(S16_path)
sgDF <- read_delim(file = file.path(sgDF_path), delim = "\t")
rRNAs16S <- readDNAStringSet(file.path(repo_dir, "gard_mapping", "clade_assignments", "16SrRNAs.fasta"))
refDF_path <- file.path(repo_dir, "GardnerellaMetadata.csv")
refDF <- read_csv(refDF_path)
figure_out <- "/Volumes/GoogleDrive/My Drive/Callahan Lab/vagMicrobiomeMetagenome/gardMapping/clade_assignments/figures"
studyIDs <- sgDF$SampleID_a
PS17 <- phyloseq(otu_table(st, taxa_are_rows=FALSE), sample_data(df), tax_table(tax))
#transform_sample_counts(function(x) {x/sum(x)}) #make read counts into relative abundances
has.shotgun <- PS17@sam_data$SampleID %in% studyIDs
PS16S_170 <- PS17 %>%
subset_samples(has.shotgun) #keep only samples of interest in OTU table
sgDF0 <- sgDF %>%
filter(PaperCohort==2017) %>%
mutate(SampleID=as.character(SampleID),
SampleID_a=as.character(SampleID_a))
gardVarTable <- PS16S_170 %>%
psmelt() %>%
dplyr::rename(SampleID_a = SampleID) %>%
filter(Genus=="Gardnerella",
Abundance>0) %>%
left_join(., sgDF0[,c("SampleID_a", "SampleID", "RNAlater")], by="SampleID_a")
varSequences <- function(label, sequences){
sequenceVariants <- unique(sequences)
names(sequenceVariants) <- paste(label, c(1:length(sequenceVariants)), sep =  "_")
print(sequenceVariants)
}
vars <- as.list(varSequences("G", gardVarTable$OTU))
strains <- names(rRNAs16S) %>%
str_extract(., ".*(?=_[0-9]{5} 16S ribosomal RNA$)")
varClades <- vars %>%
map(.,~vcountPattern(.x, rRNAs16S)) %>%
data.frame(Strain=strains) %>%
mutate(Var=case_when(G_1==1~"G1",
G_2==1~"G2",
G_3==1~"G3",
G_4==1~"G4",
G_5==1~"G5")) %>%
left_join(refDF[,c("Strain", "Clade")], by="Strain") %>%
select(Var, Clade) %>%
mutate(Clade=as.character(Clade)) %>%
unique()
varClades
gardVarTable0 <- gardVarTable %>%
mutate(Var=case_when(OTU==vars$G_1~"G1: Clades 1/2",
OTU==vars$G_2~"G2: Clades 3/4",
OTU==vars$G_3~"G3: indetereminant",
OTU==vars$G_4~"G4: Clade 5",
OTU==vars$G_5~"G5: Clade 6")) %>%
group_by(SampleID) %>%
mutate(propGard=Abundance/sum(Abundance)) %>%
ungroup() %>%
select(OTU, SampleID, SubjectID, Abundance, propGard, GWcoll, RNAlater, Var)
ggplot(data=gardVarTable0, aes(x=GWcoll, y=propGard, color=Var, shape=RNAlater)) +
geom_point() +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred2", "steelblue2", "black", "darkorchid2", "yellowgreen")) +
labs(title = "Clade assignments by 16S Amplicon Sequencing", x= "GW collection", y="Proportion of Gardnerella", shape="RNA Later", color="V4 variant")
ggsave(filename = file.path(figure_out, "cladesBy16S.pdf"))
unique(gardVarTable0$SubjectID)
ggplot(data=gardVarTable0, aes(x=GWcoll, y=propGard, color=Var, shape=RNAlater)) +
geom_point() +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred2", "steelblue2", "black", "darkorchid2", "yellowgreen")) +
labs(title = "Clade assignments by 16S Amplicon Sequencing", x= "GW collection", y="Proportion of Gardnerella", shape="RNA Later", color="V4 variant")
ggsave(filename = file.path(figure_out, "cladesBy16S.pdf"))
ggplot(data=gardVarTable0, aes(x=GWcoll, y=propGard, color=Var, shape=RNAlater)) +
geom_point() +
facet_wrap(~SubjectID) +
scale_color_manual(values=c("indianred2", "steelblue2", "black", "darkorchid2", "yellowgreen")) +
labs(title = "Clade assignments by 16S Amplicon Sequencing", x= "GW collection", y="Proportion of Gardnerella", shape="RNA Later", color="V4 variant")
