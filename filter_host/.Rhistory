library(tidyverse)
library(Biostrings)
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome"
sg_df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
cluster_path <- "/Users/hlberman/mnt/cluster/home/hlberman/VMMG"
reads_path <- file.path(cluster_path, "reads", "upload")
filtered_path <- file.path(cluster_path, "bowtie_human", "filtered_fastq")
# Load
sg_df <- read_delim(sg_df_path, delim = "\t")
reads_list <- list.files(path = reads_path, all.files = FALSE, pattern="fastq", full.names = TRUE)
filtered_list <-  list.files(path = filtered_path, all.files = FALSE, full.names = TRUE)
readDNAStringSet(reads_list[1], format = "fastq")
readDNAStringSet(filtered_list[1], format = "fastq")
readDNAStringSet(filtered_list[1], format = "fastq")
readDNAStringSet(filtered_list[2], format = "fastq")
reads_names <- list.files(reads_path, full.names = FALSE, all.files = FALSE) %>%
str_extract( pattern="_[1|2|S](?<=.fastq.gz)")
reads_names
reads_names <- list.files(reads_path, full.names = FALSE, all.files = FALSE) %>%
str_extract( pattern="_(1|2|S)(?<=.fastq.gz)")
reads_names
reads_names <- list.files(reads_path, full.names = FALSE, all.files = FALSE) %>%
str_extract( pattern="_[12S](?<=.fastq.gz)")
reads_names
reads_names <- list.files(reads_path, full.names = FALSE, all.files = FALSE) %>%
str_extract( pattern="[0-9]+_[12S]")
reads_names
reads_names <- list.files(reads_path, full.names = FALSE, all.files = FALSE, pattern = "fastq") %>%
str_extract( pattern="[0-9]+_[12S]")
reads_names
filtered_names <- list.files(filtered_path, full.names = FALSE, all.files = FALSE, pattern = "fastq") %>%
str_extract( pattern="[0-9]+_[12S]")
filtered_names
test <- readDNAStringSet(filtered_list[1], format="fastq")
test
test$width
)
table(test@ranges@width==0)
test1 <- readDNAStringSet(reads_path[1], format = "fastq")
test1
test1 <- readDNAStringSet(reads_list[1], format = "fastq")
test1
length(test1)
length(test)
length(test1)-length(test)
write("", file = file.path(getwd(), "data3.txt"))
write("", file = file.path(getwd(), "data4.txt"))
write("", file = file.path(getwd(), "data4.txt"))
library(tidyverse)
library(tidyverse)
data_32_path <- "./ex8-32.csv"
data_39_path <- "./ex8-39.csv"
data_3_path <- "./data3.txt"
data_4_path <- "./data4.txt"
data_32 <- read_csv(data_32_path)
data_39 <- read_csv(data_39_path)
data_3 <- read_delim(data_3_path, delim = "\ ")
data_4 <- read_delim(data_4_path, delim = "\ ")
View(data_3)
View(data_3)
data_3 %>%
aov(data=., Offer~Age) %>%
summary()
View(data_4)
aov_4 <- data_4 %>%
aov(data=4, Y~Tx)
summary(aov_4)
aov_4 <- data_4 %>%
aov(data=., Y~Tx)
summary(aov_4)
ggplot(data=aov_4, y=residuals, x=fitted.values)
ggplot(data=aov_4, y=residuals, x=fitted.values) +
geom_point()
ggplot(data=aov_4, aes(y=residuals, x=fitted.values)) +
geom_point()
aov_4 <- data_4 %>%
aov(data=., Y~Tx)
summary(aov_4)
ggplot(aes(y=aov_4$residuals, x=aov_4$fitted.values)) +
geom_point()
aov_4 <- data_4 %>%
aov(data=., Y~Tx)
summary(aov_4)
ggplot(data=aov_4, aes(y=residuals, x=fitted.values)) +
geom_point()
ggplot(data=aov_4, aes(y=residuals(.), x=fitted.values(.))) +
geom_point()
cbind(Residuals=aov_4$residuals, FittedValues=aov_4$fitted.values)%>%
ggplot(data=., aes(y=Residuals, x=FittedValues)) +
geom_point()
cbind(Residuals=aov_4$residuals, FittedValues=aov_4$fitted.values)%>%
as_data_frame() %>%
ggplot(data=., aes(y=Residuals, x=FittedValues)) +
geom_point()
aov_4 <- data_4 %>%
aov(data=., Y~Tx)
summary(aov_4)
cbind(Residuals=aov_4$residuals, FittedValues=aov_4$fitted.values)%>%
as_data_frame() %>%
ggplot(data=., aes(y=Residuals, x=FittedValues)) +
geom_point() +
labs(title = "Residuals vs. Fitted Values", x="Fitted Values", y="Residuals")
`4_b` <- data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean))
View(`4_b`)
`4_b` <- data_4 %>%
group_by(Tx) %>%
mutate(mean=summarise_all(list(mean)),
sigma=summarise_all(list(sd)))
`4_b` <- data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean,sd))
`4_b` <- data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))
?log
data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))%>%
mutate(logMean=log(mean),
logSD=log(sd)) %>%
ggplot(data=., aes(y=logSD, x=logMean))+
geom_point() +
geom_smooth(method = "lm", se=FALSE)
data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))%>%
mutate(logMean=log(mean),
logSD=log(sd)) %>%
ggplot(data=., aes(y=logSD, x=logMean))+
geom_point() +
geom_smooth(method = "lm", se=FALSE)+
labs(title = "$\hat{\sigma_i}$ vs. $\hat{\mu_i}$")
data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))%>%
mutate(logMean=log(mean),
logSD=log(sd)) %>%
ggplot(data=., aes(y=logSD, x=logMean))+
geom_point() +
geom_smooth(method = "lm", se=FALSE)+
labs(x="log(mean) estimates", y= "log(sd) estimates")
library(ggpubr)
data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))%>%
mutate(logMean=log(mean),
logSD=log(sd)) %>%
ggplot(data=., aes(y=logSD, x=logMean))+
geom_point() +
geom_smooth(method = "lm", se=FALSE)+
labs(x="log(mean) estimates", y= "log(sd) estimates")+
stat_regline_equation(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), label.y = -5, na.rm = TRUE, formula=y~x)
data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))%>%
mutate(logMean=log(mean),
logSD=log(sd)) %>%
ggplot(data=., aes(y=logSD, x=logMean))+
geom_point() +
geom_smooth(method = "lm", se=FALSE)+
labs(x="log(mean) estimates", y= "log(sd) estimates")+
stat_regline_equation(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), label.y = -5, na.rm = TRUE, formula=y~x))
data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))%>%
mutate(logMean=log(mean),
logSD=log(sd)) %>%
ggplot(data=., aes(y=logSD, x=logMean))+
geom_point() +
geom_smooth(method = "lm", se=FALSE)+
labs(x="log(mean) estimates", y= "log(sd) estimates")+
stat_regline_equation(aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), label.y = -5, na.rm = TRUE, formula=y~x)
data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))%>%
mutate(logMean=log(mean),
logSD=log(sd)) %>%
ggplot(data=., aes(y=logSD, x=logMean))+
geom_point() +
geom_smooth(method = "lm", se=FALSE)+
labs(x="log(mean) estimates", y= "log(sd) estimates")+
stat_regline_equation(aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), label.y = 1, na.rm = TRUE, formula=y~x)
data_4 %>%
mutate(sqY=sqrt(Y))
aov_4c <- data_4 %>%
mutate(sqY=sqrt(Y)) %>%
aov(data=., sqY~Tx)
summary(aov_4c)
cbind(Residuals=aov_4c$residuals,
FittedValues=aov_4c$fitted.values) %>%
as_data_frame()%>%
ggplot(aes(y=Residuals, x=FittedValues))+
labs(x="Fitted Values", y="Residuals")
aov_4 <- data_4 %>%
aov(data=., Y~Tx)
summary(aov_4)
data_frame(Residuals=aov_4$residuals, FittedValues=aov_4$fitted.values)%>%
ggplot(data=., aes(y=Residuals, x=FittedValues)) +
geom_point() +
labs(title = "Residuals vs. Fitted Values", x="Fitted Values", y="Residuals")
aov_4c <- data_4 %>%
mutate(sqY=sqrt(Y)) #%>%
View(aov_4c)
aov_4c <- data_4 %>%
mutate(sqY=sqrt(Y)) %>%
aov(data=., sqY~Tx)
summary(aov_4c)
aov_4c <- data_4 %>%
mutate(sqrtY=sqrt(Y)) %>%
aov(data=., sqrtY~Tx)
summary(aov_4c)
data_frame(Residuals=aov_4c$residuals,
FittedValues=aov_4c$fitted.values) %>%
ggplot(aes(y=Residuals, x=FittedValues))+
labs(x="Fitted Values", y="Residuals")
aov_4c <- data_4 %>%
mutate(sqrtY=sqrt(Y)) %>%
aov(data=., sqrtY~Tx)
summary(aov_4c)
data_frame(Residuals=aov_4c$residuals,
FittedValues=aov_4c$fitted.values) %>%
ggplot(aes(y=Residuals, x=FittedValues))+
geom_point()+
labs(x="Fitted Values", y="Residuals")
aov_4c <- data_4 %>%
mutate(sqrtY=sqrt(Y)) %>%
aov(data=., sqrtY~Tx)
summary(aov_4c)
data_frame(Residuals=aov_4c$residuals,
FittedValues=aov_4c$fitted.values) %>%
ggplot(aes(y=Residuals, x=FittedValues))+
geom_point()+
labs(x="Fitted Values", y="Residuals")
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Tx=list("Elderly"=1, "Young and Middle Age" = 2)))
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Age=list("Elderly"=1, "Young and Middle Age" = 2)))
aov(data=data_30, Offer~Age) %>%
summary.aov(.) #split=list(Age=list("Elderly"=1, "Young and Middle Age" = 2)))
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Age=list("Elderly vs. young and middle-aged")))
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Age=list("Elderly vs. young and middle-aged"=1)))
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Age=list("Elderly vs. young and middle-aged"=1)))
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Age="Elderly vs. young and middle-aged"))
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Age=list("Elderly vs. young and middle-aged"=1)))
data_3 %>%
aov(data=., Offer~Age) %>%
summary()
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Age=list("Elderly vs. young and middle-aged"=1)))
base::levels(data_30$Age)
aov_4 <- data_4 %>%
aov(data=., Y~Tx)
summary(aov_4)
data_frame(Residuals=aov_4$residuals, FittedValues=aov_4$fitted.values)%>%
ggplot(data=., aes(y=Residuals, x=FittedValues)) +
geom_point() +
labs(title = "Residuals vs. Fitted Values", x="Fitted Values", y="Residuals")
data_4 %>%
group_by(Tx) %>%
summarise_all(list(mean=mean,sd=sd))%>%
mutate(logMean=log(mean),
logSD=log(sd)) %>%
ggplot(data=., aes(y=logSD, x=logMean))+
geom_point() +
geom_smooth(method = "lm", se=FALSE)+
labs(x="log(mean) estimates", y= "log(sd) estimates")+
stat_regline_equation(aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), label.y = 1, na.rm = TRUE, formula=y~x)
aov_4c <- data_4 %>%
mutate(sqrtY=sqrt(Y)) %>%
aov(data=., sqrtY~Tx)
summary(aov_4c)
data_frame(Residuals=aov_4c$residuals,
FittedValues=aov_4c$fitted.values) %>%
ggplot(aes(y=Residuals, x=FittedValues))+
geom_point()+
labs(x="Fitted Values", y="Residuals")
data_30 <- data_3 %>%
mutate(Age=as.factor(Age))
base::levels(data_30$Age)
contrasts(data_30$Age) <- c(-1,0.5,0.5)
aov(data=data_30, Offer~Age) %>%
summary.aov(., split=list(Age=list("Elderly vs. young and middle-aged"=1)))
