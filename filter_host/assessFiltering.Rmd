---
title: "Assess Human Filtering"
author: "Hanna Berman"
date: "3/5/2019"
output: html_document
---
# Set up
## Packages
```{r setup, include=FALSE}
library(tidyverse)
library(Biostrings)
library(BiocParallel)
```

## File paths 
```{r}
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDF_path <- file.path(repo_dir, "filter_host", "fastq_counts.txt")
sg_df_path <- file.path(repo_dir, "shotgunMetadata.tsv")
krakenReads <- read_delim(file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv"), delim="\t")

#Load
sg_df <- read_delim(sg_df_path, delim = "\t")
countsDF <- read_delim(countsDF_path, delim="\ ")
```

# Compare amount of human reads filtered
```{r}
countsDF0 <- countsDF %>%
  mutate(uploadCount1=uploadCount1/4,
         uploadCount2=uploadCount2/4,
         uploadCountS=uploadCountS/4,
         filteredCount1=filteredCount1/4,
         filteredCount2=filteredCount2/4,
         filteredCountS=filteredCountS/4,
         uploadTotal=uploadCount1+uploadCount2+uploadCountS,
         filteredTotal=filteredCount1+filteredCount2+filteredCountS,
         pctFiltered=filteredTotal/uploadTotal,
         pctHuman2=(uploadTotal-filteredTotal)/uploadTotal,
         SampleID=Sample)


sg_df0 <- sg_df %>%
  left_join(., countsDF0[,c("SampleID", "pctHuman2")], by="SampleID") %>%
  left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
  mutate(difference=abs(pctHuman2-PctHuman),
         differenceK=abs(pctHuman2-krakenHuAbundance))

sapply(list(upload=sg_df0$PctHuman, hannaBowtie=sg_df0$pctHuman2, kracken=sg_df0$krakenHuAbundance, difference1=sg_df0$difference, differenceKracken=sg_df0$differenceK), summary)

ggplot(sg_df0) +
  geom_line(aes(x=as.character(SampleID), y=PctHuman, group=1), color = "black", show.legend = TRUE) +
  geom_line(aes(x=as.character(SampleID), y=krakenHuAbundance,group=1), color="blue", show.legend = TRUE) +
  geom_line(aes(x=as.character(SampleID), y=pctHuman2,group=1), color="red", show.legend = TRUE) +
  theme(axis.text.x = element_blank())+
  labs(title ="black:upload, red:Hanna Bowtie, blue:kraken", x="Sample", y="Proportion Human Reads") 
```

# Session Info
```{r}
sessionInfo()
```