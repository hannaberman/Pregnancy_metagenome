n_distinct()
range(sgDF1$GDcoll)
summary(sgDF1$GDcoll[sgDF1$sampleOrder==1])
summary(sgDF1$GDcoll[sgDF1$sampleOrder==2])
summary(sgDF1$GDcoll[sgDF1$sampleOrder==3])
sgDF1 %>%
ggplot(aes(x=sampleOrder, y=GDcoll, group=sampleOrder)) +
geom_boxplot() +
geom_point() +
facet_wrap(~Cohort) +
labs(x="Sample Order", y="Gestation Days at Collection")
sgDF1 %>%
ggplot(aes(x=GDcoll, y=as.character(SubjectID), color=Cohort)) +
geom_point() +
geom_vline(xintercept = 97.5)+
geom_vline(xintercept = 195.5) +
labs(x="Gestation Days at Collection", y="Subject ID")
#Create dataframe of subsets
sgDFsubset <- sgDF1 %>%
filter(sampleTrimester=="Second") %>%
group_by(SubjectID) %>%
sample_n(size=1) %>%
ungroup
sampleSubset <- sgDFsubset$SampleID
sampleSubset
#save list of subset
#write_lines(sampleSubset, "../sampleSubset.txt")
#what subject is missing a sample
setdiff(unique(sgDF$SubjectID), sgDFsubset$SubjectID)
summary(sgDFsubset$GDcoll)
library(tidyverse)
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDFbowtie <- file.path(repo_dir, "filter_host", "fastq_counts.txt") %>%
read_delim(delim="\ ")
countsDFbbmap <- file.path(repo_dir, "filter_host", "fastq_counts_bbmap.txt") %>%
read_delim(delim="\ ")
sgDF <- file.path(repo_dir, "shotgunMetadata.tsv") %>%
read_tsv()
krakenReads <- file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv") %>%
read_tsv()
#bowtie by HLB counts
countsDhbBowtieF0 <- countsDFbowtie %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2, #+uploadCountS,
filteredTotalBowtie=filteredCount1+filteredCount2, #+filteredCountS,
pctFilteredBowtie=filteredTotalBowtie/uploadTotal,
pctHumanBowtie=(uploadTotal-filteredTotalBowtie)/uploadTotal,
SampleID=Sample)
#bbmap by HLB counts
countsDFbbmap0 <- countsDFbbmap %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2,  #+uploadCountS,
filteredTotalBbmap=filteredCount1+filteredCount2,  #+filteredCountS,
pctFilteredBbmap=filteredTotalBbmap/uploadTotal,
pctHumanBbmap=(uploadTotal-filteredTotalBbmap)/uploadTotal,
SampleID=Sample)
sgDF0 <- sgDF %>%
select(SampleID, PctHuman) %>%
dplyr::rename(Upload=PctHuman) %>%
left_join(., countsDhbBowtieF0[,c("SampleID", "pctHumanBowtie")], by="SampleID") %>%
left_join(., countsDFbbmap0[,c("SampleID", "pctHumanBbmap")], by="SampleID") %>%
left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
dplyr::rename(Kraken=krakenHuAbundance, BBmap=pctHumanBbmap, Bowtie=pctHumanBowtie) %>%
gather("Method", "PctHuman", 2:ncol(.))
ggplot(sgDF0) +
geom_line(aes(x=as.character(SampleID), y=PctHuman, color=Method, group=Method), show.legend = TRUE) +
theme(axis.text.x = element_blank())+
labs(x="Sample", y="Proportion Human Reads") +
scale_color_manual(values=c("black", "red", "blue", "darkgreen"))
#ggsave("/Volumes/GoogleDrive/My Drive/Callahan Lab/vagMicrobiomeMetagenome/filter_host/filterHuman.pdf")
sgDF1 <- countsDFbbmap0 %>%
mutate(bbmapFiltered_pairs=filteredCount1,
bbmapFiltered_sngl=filteredCountS,
upload_pairs=uploadCount1,
upload_sngl=uploadCountS) %>%
select(SampleID, bbmapFiltered_pairs, bbmapFiltered_sngl, upload_pairs, upload_sngl) %>%
left_join(sgDF, by="SampleID") %>%
mutate(finalPctHuman_po=((Sickle_pairs-bbmapFiltered_pairs)/Sickle_pairs), #pairs only
finalPctHuman_all=((Sickle_pairs+Sickle_sngl)-(bbmapFiltered_pairs+bbmapFiltered_sngl))/(Sickle_pairs+Sickle_sngl)) %>%
select(SampleIndex, SampleType, SubjectID, SampleID, GDcoll, GWcoll, GWdell, TermPre, Operator, TotalReads, TotalPairs, Sickle100_pe, Sickle_pairs, Sickle_sngl, PctTrim, Human_pairs, Human_sngl, PctHuman, upload_pairs, upload_sngl, bbmapFiltered_pairs, bbmapFiltered_sngl, finalPctHuman_po, finalPctHuman_all, SampleID_a, RNAlater, Cohort, PaperCohort, sampleOrder, sampleTrimester)
write_tsv(sgDF1, file.path(repo_dir, "shotgunMetadata.tsv"))
# bbmapReads <- sgDF %>%
#   select(SampleID, bbmapFiltered_pe, bbmapFiltered_s) %>%
#   mutate(totalBBmap=bbmapFiltered_pe+bbmapFiltered_s,
#          pctSingles=bbmapFiltered_s/totalBBmap)
# View(bbmapReads)
# summary(bbmapReads$pctSingles)
#
# ggplot(bbmapReads, aes(x=pctSingles)) +
#   geom_histogram()
#
# ggplot(bbmapReads, aes(x=1, y=pctSingles)) +
#   geom_boxplot() +
#   geom_jitter()
#
# bbmapReads %>%
#   gather("p_s", "count", c(bbmapFiltered_pe, bbmapFiltered_s)) %>%
#   ggplot(., aes(x=reorder(as.character(SampleID), count), y=count, fill=p_s)) +
#   geom_bar(stat="identity")
#
#
# bbmapReads %>%
#   ggplot(aes(x=pctSingles, y=bbmapFiltered_pe))+
#   geom_jitter()
View(countsDFbowtie)
View(countsDFbbmap)
library(tidyverse)
set.seed(7334)
# sgDF <- "./shotgunMetadata.tsv" %>%
#   read_tsv() %>%
#   mutate(SubjectID= as.character(SubjectID))
sgDF <- "./Tables_4_Ben.txt" %>%
read_delim(delim="\t") %>%
dplyr::rename(SampleIndex=`Sample Index`,
SampleType=`Sample Type`,
SubjectID=Subject,
SampleID=`Sample ID`,
GDcoll=GD_Coll,
GWdell=GW_Dell,
TermPre=`Term/Pre`,
TotalReads=`Total reads`,
TotalPairs=`Total pairs`,
Sickle100_pe=`Sickle_100 (pe)`,
Sickle_pairs=Sickle_pe,
Human_pairs=Human_pe,
PctTrim=`Pct Trim`,
PctHuman=`Pct Human`) %>%
mutate(SampleID=as.character(SampleID),
SubjectID=as.character(SubjectID),
PctTrim=as.numeric(as.character(str_extract(PctTrim, ".*(?=\\%)")))/100,
PctHuman=as.numeric(as.character(str_extract(PctHuman, ".*(?=\\%)")))/100,
GWcoll=GDcoll/7,
SampleID_a=paste0(substr(SampleID, 1, 5), "01", substr(SampleID, 8, 10)),
RNAlater=case_when(str_detect(SampleID, "[0-9]{5}01[0-9]{3}")~"No",
str_detect(SampleID, "[0-9]{5}35[0-9]{3}")~"Yes"))
head(sgDF)
#sickle pairs == half of `Sickle100_pe`
sgDF %>%
select(Sickle100_pe, Sickle_pairs) %>%
mutate(test=Sickle_pairs*2,
TF=case_when(test==Sickle100_pe~TRUE,
test!=Sickle100_pe~FALSE)) %>%
.$TF %>%
table()
#Percent trimmed is Sickle 100 paired and single reads divided by total reads
sgDF %>%
select(TotalReads, Sickle100_pe, Sickle_sngl, PctTrim) %>%
mutate(test=as.character(round(((Sickle100_pe+Sickle_sngl)/TotalReads), 4)),
PctTrim=as.character(PctTrim),
TF=case_when(test==PctTrim~TRUE,
test!=PctTrim~FALSE)) %>%
.$TF %>%
table()
#Percent human is bowtie paired and single reads divided by total reads
sgDF %>%
select(Sickle100_pe, Sickle_pairs, Sickle_sngl, Human_pairs, Human_sngl,PctHuman) %>%
mutate(test=as.character(round((Human_pairs*2+Human_sngl)/(Sickle100_pe+Sickle_sngl),4)),
PctHuman=as.character(PctHuman),
TF=case_when(test==PctHuman~TRUE,
test!=PctHuman~FALSE)) %>%
.$TF %>%
table
PS15 <- "./sampledata_VaginalSwabs_Pregnancy_DiGiulio2015.tsv" %>%
read_tsv() %>%
dplyr::rename(GDcoll=GDColl) %>%
mutate(SubjectID= as.character(SubjectID),
Cohort="Stanford",
Method="Amplicon",
PaperCohort="2015") %>%
select(SampleID, SubjectID, GDcoll, Cohort, Method, PaperCohort)
PS17 <- "./MAP_MANUSCRIPT_IL02-IL09_ToBen_20170404_fixed.txt" %>%
read_delim(delim="\t") %>%
mutate(SubjectID= as.character(SubjectID),
Cohort=case_when(UAB_Sample==0~"Stanford",
UAB_Sample==1~"UAB"),
Method="Amplicon",
PaperCohort="2017") %>%
select(SampleID, SubjectID, GDcoll, Cohort, Method, PaperCohort)
AMP <- rbind(PS15, PS17) %>%
unique.data.frame()
sgDF0 <- sgDF %>%
left_join(AMP[,c("SubjectID", "Cohort", "PaperCohort")], by="SubjectID") %>%
filter(SampleID %in% sgDF$SampleID) %>%
mutate(Cohort=replace_na(Cohort,"Stanford")) %>%
unique.data.frame()
SHOT <- sgDF0 %>%
select(SubjectID, GDcoll, Cohort, PaperCohort) %>%
filter(PaperCohort=="2015"|PaperCohort=="2017") %>%
mutate(Method="Shotgun") %>%
unique.data.frame()
ggplot() +
geom_point(data=AMP, aes(x=GDcoll, y=as.character(SubjectID), shape=Method, color=Cohort, size=Method), alpha=.5) +
geom_point(data=SHOT, aes(x=GDcoll, y=as.character(SubjectID), shape=Method, size=Method), color="black") +
xlim(0,280) +
labs(x = "Gestation Days",
y = "Subject") +
scale_color_manual(values=c("olivedrab", "steelblue", "black"))+
scale_shape_manual(values=c(19, 15)) +
scale_size_manual(values=c(1,2)) +
#theme_classic()+
theme(axis.ticks.y = element_blank(),
#axis.text.x = element_text(size = 10),
axis.text.y  = element_blank()
#axis.title.x = element_text(size=20),
#axis.title.y = element_text(size=20)
)
#scale_x_continuous(breaks = c(0,50,100,150,200, 250))
#ggsave("/Users/hlberman/Desktop/collectionPlot.svg", height=8, width=8.5)
sgDF1 <- sgDF0 %>%
group_by(SubjectID) %>%
mutate(sampleOrder=rank(GDcoll),
sampleTrimester=case_when(GDcoll<=97~"First",
GDcoll>=98&GDcoll<=195~"Second",
GDcoll>=196~"Third")) %>%
ungroup()
#save updated dataframe
write_tsv(sgDF1, "../shotgunMetadata.tsv")
sgDF1 %>%
filter(Cohort=="UAB")%>%
nrow()
sgDF1 %>%
filter(Cohort=="UAB") %>%
select(SubjectID) %>%
n_distinct()
sgDF1 %>%
filter(Cohort=="Stanford")%>%
nrow()
sgDF1 %>%
filter(Cohort=="Stanford") %>%
select(SubjectID) %>%
n_distinct()
range(sgDF1$GDcoll)
summary(sgDF1$GDcoll[sgDF1$sampleOrder==1])
summary(sgDF1$GDcoll[sgDF1$sampleOrder==2])
summary(sgDF1$GDcoll[sgDF1$sampleOrder==3])
sgDF1 %>%
ggplot(aes(x=sampleOrder, y=GDcoll, group=sampleOrder)) +
geom_boxplot() +
geom_point() +
facet_wrap(~Cohort) +
labs(x="Sample Order", y="Gestation Days at Collection")
sgDF1 %>%
ggplot(aes(x=GDcoll, y=as.character(SubjectID), color=Cohort)) +
geom_point() +
geom_vline(xintercept = 97.5)+
geom_vline(xintercept = 195.5) +
labs(x="Gestation Days at Collection", y="Subject ID")
#Create dataframe of subsets
sgDFsubset <- sgDF1 %>%
filter(sampleTrimester=="Second") %>%
group_by(SubjectID) %>%
sample_n(size=1) %>%
ungroup
sampleSubset <- sgDFsubset$SampleID
sampleSubset
#save list of subset
#write_lines(sampleSubset, "../sampleSubset.txt")
#what subject is missing a sample
setdiff(unique(sgDF$SubjectID), sgDFsubset$SubjectID)
summary(sgDFsubset$GDcoll)
library(tidyverse)
set.seed(7334)
# sgDF <- "./shotgunMetadata.tsv" %>%
#   read_tsv() %>%
#   mutate(SubjectID= as.character(SubjectID))
sgDF <- "./Tables_4_Ben.txt" %>%
read_delim(delim="\t") %>%
dplyr::rename(SampleIndex=`Sample Index`,
SampleType=`Sample Type`,
SubjectID=Subject,
SampleID=`Sample ID`,
GDcoll=GD_Coll,
GWdell=GW_Dell,
TermPre=`Term/Pre`,
TotalReads=`Total reads`,
TotalPairs=`Total pairs`,
Sickle100_pe=`Sickle_100 (pe)`,
Sickle_pairs=Sickle_pe,
Human_pairs=Human_pe,
PctTrim=`Pct Trim`,
PctHuman=`Pct Human`) %>%
mutate(SampleID=as.character(SampleID),
SubjectID=as.character(SubjectID),
PctTrim=as.numeric(as.character(str_extract(PctTrim, ".*(?=\\%)")))/100,
PctHuman=as.numeric(as.character(str_extract(PctHuman, ".*(?=\\%)")))/100,
GWcoll=GDcoll/7,
SampleID_a=paste0(substr(SampleID, 1, 5), "01", substr(SampleID, 8, 10)),
RNAlater=case_when(str_detect(SampleID, "[0-9]{5}01[0-9]{3}")~"No",
str_detect(SampleID, "[0-9]{5}35[0-9]{3}")~"Yes"))
head(sgDF)
#sickle pairs == half of `Sickle100_pe`
sgDF %>%
select(Sickle100_pe, Sickle_pairs) %>%
mutate(test=Sickle_pairs*2,
TF=case_when(test==Sickle100_pe~TRUE,
test!=Sickle100_pe~FALSE)) %>%
.$TF %>%
table()
#Percent trimmed is Sickle 100 paired and single reads divided by total reads
sgDF %>%
select(TotalReads, Sickle100_pe, Sickle_sngl, PctTrim) %>%
mutate(test=as.character(round(((Sickle100_pe+Sickle_sngl)/TotalReads), 4)),
PctTrim=as.character(PctTrim),
TF=case_when(test==PctTrim~TRUE,
test!=PctTrim~FALSE)) %>%
.$TF %>%
table()
#Percent human is bowtie paired and single reads divided by total reads
sgDF %>%
select(Sickle100_pe, Sickle_pairs, Sickle_sngl, Human_pairs, Human_sngl,PctHuman) %>%
mutate(test=as.character(round((Human_pairs*2+Human_sngl)/(Sickle100_pe+Sickle_sngl),4)),
PctHuman=as.character(PctHuman),
TF=case_when(test==PctHuman~TRUE,
test!=PctHuman~FALSE)) %>%
.$TF %>%
table
PS15 <- "./sampledata_VaginalSwabs_Pregnancy_DiGiulio2015.tsv" %>%
read_tsv() %>%
dplyr::rename(GDcoll=GDColl) %>%
mutate(SubjectID= as.character(SubjectID),
Cohort="Stanford",
Method="Amplicon",
PaperCohort="2015") %>%
select(SampleID, SubjectID, GDcoll, Cohort, Method, PaperCohort)
PS17 <- "./MAP_MANUSCRIPT_IL02-IL09_ToBen_20170404_fixed.txt" %>%
read_delim(delim="\t") %>%
mutate(SubjectID= as.character(SubjectID),
Cohort=case_when(UAB_Sample==0~"Stanford",
UAB_Sample==1~"UAB"),
Method="Amplicon",
PaperCohort="2017") %>%
select(SampleID, SubjectID, GDcoll, Cohort, Method, PaperCohort)
AMP <- rbind(PS15, PS17) %>%
unique.data.frame()
sgDF0 <- sgDF %>%
left_join(AMP[,c("SubjectID", "Cohort", "PaperCohort")], by="SubjectID") %>%
filter(SampleID %in% sgDF$SampleID) %>%
mutate(Cohort=replace_na(Cohort,"Stanford")) %>%
unique.data.frame()
SHOT <- sgDF0 %>%
select(SubjectID, GDcoll, Cohort, PaperCohort) %>%
filter(PaperCohort=="2015"|PaperCohort=="2017") %>%
mutate(Method="Shotgun") %>%
unique.data.frame()
ggplot() +
geom_point(data=AMP, aes(x=GDcoll, y=as.character(SubjectID), shape=Method, color=Cohort, size=Method), alpha=.5) +
geom_point(data=SHOT, aes(x=GDcoll, y=as.character(SubjectID), shape=Method, size=Method), color="black") +
xlim(0,280) +
labs(x = "Gestation Days",
y = "Subject") +
scale_color_manual(values=c("olivedrab", "steelblue", "black"))+
scale_shape_manual(values=c(19, 15)) +
scale_size_manual(values=c(1,2)) +
#theme_classic()+
theme(axis.ticks.y = element_blank(),
#axis.text.x = element_text(size = 10),
axis.text.y  = element_blank()
#axis.title.x = element_text(size=20),
#axis.title.y = element_text(size=20)
)
#scale_x_continuous(breaks = c(0,50,100,150,200, 250))
#ggsave("/Users/hlberman/Desktop/collectionPlot.svg", height=8, width=8.5)
sgDF1 <- sgDF0 %>%
group_by(SubjectID) %>%
mutate(sampleOrder=rank(GDcoll),
sampleTrimester=case_when(GDcoll<=97~"First",
GDcoll>=98&GDcoll<=195~"Second",
GDcoll>=196~"Third")) %>%
ungroup()
#save updated dataframe
write_tsv(sgDF1, "../shotgunMetadata.tsv")
sgDF1 %>%
filter(Cohort=="UAB")%>%
nrow()
sgDF1 %>%
filter(Cohort=="UAB") %>%
select(SubjectID) %>%
n_distinct()
sgDF1 %>%
filter(Cohort=="Stanford")%>%
nrow()
sgDF1 %>%
filter(Cohort=="Stanford") %>%
select(SubjectID) %>%
n_distinct()
range(sgDF1$GDcoll)
summary(sgDF1$GDcoll[sgDF1$sampleOrder==1])
summary(sgDF1$GDcoll[sgDF1$sampleOrder==2])
summary(sgDF1$GDcoll[sgDF1$sampleOrder==3])
sgDF1 %>%
ggplot(aes(x=sampleOrder, y=GDcoll, group=sampleOrder)) +
geom_boxplot() +
geom_point() +
facet_wrap(~Cohort) +
labs(x="Sample Order", y="Gestation Days at Collection")
sgDF1 %>%
ggplot(aes(x=GDcoll, y=as.character(SubjectID), color=Cohort)) +
geom_point() +
geom_vline(xintercept = 97.5)+
geom_vline(xintercept = 195.5) +
labs(x="Gestation Days at Collection", y="Subject ID")
#Create dataframe of subsets
sgDFsubset <- sgDF1 %>%
filter(sampleTrimester=="Second") %>%
group_by(SubjectID) %>%
sample_n(size=1) %>%
ungroup
sampleSubset <- sgDFsubset$SampleID
sampleSubset
#save list of subset
#write_lines(sampleSubset, "../sampleSubset.txt")
#what subject is missing a sample
setdiff(unique(sgDF$SubjectID), sgDFsubset$SubjectID)
summary(sgDFsubset$GDcoll)
library(tidyverse)
#set paths
repo_dir <- "/Users/hlberman/Documents/GitHub/pregnancy_metagenome/"
countsDFbowtie <- file.path(repo_dir, "filter_host", "fastq_counts.txt") %>%
read_delim(delim="\ ")
countsDFbbmap <- file.path(repo_dir, "filter_host", "fastq_counts_bbmap.txt") %>%
read_delim(delim="\ ")
sgDF <- file.path(repo_dir, "shotgunMetadata.tsv") %>%
read_tsv()
krakenReads <- file.path(repo_dir, "methods_comparisons", "assess_kraken", "krakenHumanReads.tsv") %>%
read_tsv()
#bowtie by HLB counts
countsDhbBowtieF0 <- countsDFbowtie %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2, #+uploadCountS,
filteredTotalBowtie=filteredCount1+filteredCount2, #+filteredCountS,
pctFilteredBowtie=filteredTotalBowtie/uploadTotal,
pctHumanBowtie=(uploadTotal-filteredTotalBowtie)/uploadTotal,
SampleID=Sample)
#bbmap by HLB counts
countsDFbbmap0 <- countsDFbbmap %>%
mutate(uploadCount1=uploadCount1/4,
uploadCount2=uploadCount2/4,
uploadCountS=uploadCountS/4,
filteredCount1=filteredCount1/4,
filteredCount2=filteredCount2/4,
filteredCountS=filteredCountS/4,
uploadTotal=uploadCount1+uploadCount2,  #+uploadCountS,
filteredTotalBbmap=filteredCount1+filteredCount2,  #+filteredCountS,
pctFilteredBbmap=filteredTotalBbmap/uploadTotal,
pctHumanBbmap=(uploadTotal-filteredTotalBbmap)/uploadTotal,
SampleID=Sample)
sgDF0 <- sgDF %>%
select(SampleID, PctHuman) %>%
dplyr::rename(Upload=PctHuman) %>%
left_join(., countsDhbBowtieF0[,c("SampleID", "pctHumanBowtie")], by="SampleID") %>%
left_join(., countsDFbbmap0[,c("SampleID", "pctHumanBbmap")], by="SampleID") %>%
left_join(., krakenReads[,c("SampleID", "krakenHuAbundance")], by ="SampleID") %>%
dplyr::rename(Kraken=krakenHuAbundance, BBmap=pctHumanBbmap, Bowtie=pctHumanBowtie) %>%
gather("Method", "PctHuman", 2:ncol(.))
ggplot(sgDF0) +
geom_line(aes(x=as.character(SampleID), y=PctHuman, color=Method, group=Method), show.legend = TRUE) +
theme(axis.text.x = element_blank())+
labs(x="Sample", y="Proportion Human Reads") +
scale_color_manual(values=c("black", "red", "blue", "darkgreen"))
#ggsave("/Volumes/GoogleDrive/My Drive/Callahan Lab/vagMicrobiomeMetagenome/filter_host/filterHuman.pdf")
sgDF1 <- countsDFbbmap0 %>%
mutate(bbmapFiltered_pairs=filteredCount1,
bbmapFiltered_sngl=filteredCountS,
upload_pairs=uploadCount1,
upload_sngl=uploadCountS) %>%
select(SampleID, bbmapFiltered_pairs, bbmapFiltered_sngl, upload_pairs, upload_sngl) %>%
left_join(sgDF, by="SampleID") %>%
mutate(finalPctHuman_po=((Sickle_pairs-bbmapFiltered_pairs)/Sickle_pairs), #pairs only
finalPctHuman_all=((Sickle_pairs+Sickle_sngl)-(bbmapFiltered_pairs+bbmapFiltered_sngl))/(Sickle_pairs+Sickle_sngl)) %>%
select(SampleIndex, SampleType, SubjectID, SampleID, GDcoll, GWcoll, GWdell, TermPre, Operator, TotalReads, TotalPairs, Sickle100_pe, Sickle_pairs, Sickle_sngl, PctTrim, Human_pairs, Human_sngl, PctHuman, upload_pairs, upload_sngl, bbmapFiltered_pairs, bbmapFiltered_sngl, finalPctHuman_po, finalPctHuman_all, SampleID_a, RNAlater, Cohort, PaperCohort, sampleOrder, sampleTrimester)
write_tsv(sgDF1, file.path(repo_dir, "shotgunMetadata.tsv"))
# bbmapReads <- sgDF %>%
#   select(SampleID, bbmapFiltered_pe, bbmapFiltered_s) %>%
#   mutate(totalBBmap=bbmapFiltered_pe+bbmapFiltered_s,
#          pctSingles=bbmapFiltered_s/totalBBmap)
# View(bbmapReads)
# summary(bbmapReads$pctSingles)
#
# ggplot(bbmapReads, aes(x=pctSingles)) +
#   geom_histogram()
#
# ggplot(bbmapReads, aes(x=1, y=pctSingles)) +
#   geom_boxplot() +
#   geom_jitter()
#
# bbmapReads %>%
#   gather("p_s", "count", c(bbmapFiltered_pe, bbmapFiltered_s)) %>%
#   ggplot(., aes(x=reorder(as.character(SampleID), count), y=count, fill=p_s)) +
#   geom_bar(stat="identity")
#
#
# bbmapReads %>%
#   ggplot(aes(x=pctSingles, y=bbmapFiltered_pe))+
#   geom_jitter()
234432/4
234532/4
